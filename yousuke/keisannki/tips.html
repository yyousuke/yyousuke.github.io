<!doctype html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="author" content="山下陽介 (Yousuke Yamashita)  国立環境研究所 (National Institute for Environmental Studies, NIES)" />
<link rel="icon" type="image/vnd.microsoft.icon" href="/favicon.ico" />
<link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon-180x180.png" />
<link rel="icon" type="image/png" href="/icon-192x192.png" />
<!-- Mobile Internet Explorer allows us to activate ClearType technology for smoothing fonts for easy reading -->
<meta http-equiv="cleartype" content="on" />
<!-- Specify whether or not telephone numbers in the HTML content should appear as hypertext links -->
<meta name="format-detection" content="telephone=no" />
<!-- Changes the logical window size used when displaying a page mobile browsers -->
<meta name = "viewport" content = "width = device-width, initial-scale=1, user-scalable=yes" />

<meta name="robots" content="nofollow" />
<meta name="http-equiv" content="X-Robots-Tag : nofollow" />
<meta name="googlebot" content="nofollow" />
<meta name="description" content="" />
<meta name="keywords" content="crontab" />
<link href="design_keisannki.css" rel="stylesheet" type="text/css" />
<title>計算機TIPS</title>
</head>

<body>
<div id="nesting">
<a href="/~yyousuke">ホーム</a> &gt; <a href="/~yyousuke/yousuke/index.html">山下のページ</a>  &gt; <a href="/~yyousuke/yousuke/keisannki/index.html">計算機関連</a> &gt; TIPS
</div>
<article>
<h1 id="top">計算機TIPS</h1>
<br />
<p>&nbsp; ここでは、主にLinux系の計算機におけるTIPSを載せています。まだ正式公開版ではなくメモ書き程度ですので、その点に留意して頂ければ幸いです。コマンド入力の説明では、%が一般ユーザのプロンプトを、#がrootのプロンプトを表しています。</p>
<br /><hr />

<!-- 目次 -->

<h2 id="contents">目次</h2>
<div class="contents">
  <!-- スケジュール管理 -->
  <ul class="list1"><li><a href="#linux_1">スケジュール管理</a>
    <ul class="list2">
      <li><a href="#linux_1_1">crontabに登録する</a></li>
      <li><a href="#linux_1_2">ユーザを指定してcrontabに登録する</a></li>
      <li><a href="#linux_1_3">crontabで月末に実行する</a></li>
  </ul>
  </li></ul>
  <!-- メモリ使用量 -->
  <ul class="list1"><li><a href="#linux_2">メモリ使用量</a>
    <ul class="list2">
      <li><a href="#linux_2_1">プロセス毎の詳細なメモリ使用量を調べる</a></li>
      <li><a href="#linux_2_2">実行時に確保するメモリ領域毎のサイズを表示</a></li>
  </ul>
  </li></ul>
  <!-- emacs関連 -->
  <ul class="list1"><li><a href="#emacs_1">emacs関連</a>
    <ul class="list2">
      <li><a href="#emacs_1_1">emacsでカーソル位置を保存する</a></li>
      <li><a href="#emacs_1_2">emacsで長い行を折り返す</a></li>
      <li><a href="#emacs_1_3">emacsで矩形選択</a></li>
      <li><a href="#emacs_1_4">emacsで末尾のエスケープを揃える</a></li>
  </ul>
  </li></ul>
  <!-- vi関連 -->
  <ul class="list1"><li><a href="#vi_1">vi関連</a>
    <ul class="list2">
      <li><a href="#vi_1_1">viの基本的な操作</a></li>
      <li><a href="#vi_1_2">viの設定変更</a></li>
  </ul>
  </li></ul>
  <!-- awk関連 -->
  <ul class="list1"><li><a href="#awk_1">awk関連</a>
    <ul class="list2">
      <li><a href="#awk_1_1">書式を指定する</a></li>
  </ul>
  </li></ul>  
  <!-- ネットワーク関連 -->
  <ul class="list1"><li><a href="#network_1">ネットワーク関連</a>
    <ul class="list2">
      <li><a href="#network_1_1">IPアドレスを確認する</a></li>
      <li><a href="#network_1_2">ネットワークデバイスを表示する</a></li>
      <li><a href="#network_1_3">ルーティングテーブルの内容を表示する</a></li>
      <li><a href="#network_1_4">通信の状態を調べる</a></li>
      <li><a href="#network_1_5">LISTENポートをチェックする</a></li>
      <li><a href="#network_1_6">サービス一覧を表示する</a></li>
  </ul>
  </li></ul>
  <!-- ユーザ管理 -->
  <ul class="list1"><li><a href="#user_1">ユーザ管理</a>
    <ul class="list2">
      <li><a href="#user_1_1">ユーザを追加する</a></li>
      <li><a href="#user_1_2">グループを追加する</a></li>
      <li><a href="#user_1_3">ユーザをグループに追加する</a></li>
  </ul>
  </li></ul>
  <!-- システム管理 -->
  <ul class="list1"><li><a href="#system_1">システム管理</a>
    <ul class="list2">
      <li><a href="#system_1_1">ログ通知</a></li>
  </ul>
  </li></ul>
  <!-- SSH関連 -->
  <ul class="list1"><li><a href="#ssh_1">SSH関連</a>
    <ul class="list2">
      <li><a href="#ssh_1_1">ホスト公開鍵の更新</a></li>
      <li><a href="#ssh_1_2">SSH秘密鍵と公開鍵の新規生成</a></li>
      <li><a href="#ssh_1_3">ユーザー名を指定してログイン</a></li>
      <li><a href="#ssh_1_4">秘密鍵を指定してログイン</a></li>
      <li><a href="#ssh_1_5">X11転送を有効</a></li>
      <li><a href="#ssh_1_6">configファイルを使ってログイン</a></li>
      <li><a href="#ssh_1_7">カスケード接続</a></li>
      <li><a href="#ssh_1_8">ポートフォワード</a></li>
  </ul>
  </li></ul>
  <!-- bash関連 -->
  <ul class="list1"><li><a href="#bash_1">bash関連</a>
    <ul class="list2">
      <li><a href="#bash_1_1">配列の作成</a></li>
      <li><a href="#bash_1_2">配列の値の変更、配列への追加</a></li>
      <li><a href="#bash_1_3">配列の要素数を表示する</a></li>
      <li><a href="#bash_1_4">配列の要素を順に利用する</a></li>
      <li><a href="#bash_1_5">コマンドの結果を配列に入力する</a></li>
      <li><a href="#bash_1_6">リダイレクト</a></li>
      <li><a href="#bash_1_7">数字の桁</a></li>
  </ul>
  </li></ul>
  <!-- その他コマンド -->
  <ul class="list1"><li><a href="#com_1">その他コマンド</a>
    <ul class="list2">
      <li><a href="#com_1_1">grepで該当行の前後２行を表示する</a></li>
      <li><a href="#com_1_2">diffを+-記号表示にする</a></li>
      <li><a href="#com_1_3">nkfでUTF-8とLF形式にする</a></li>
      <li><a href="#com_1_4">teeでmakeログを作成しながら画面表示</a></li>
      <li><a href="#com_1_5">apgでパスワード自動生成</a></li>
  </ul>
  </li></ul>
</div>

<small><a href="#top">[top]</a></small> <br />
<br />
<hr width="105%" />
<br />


<!-- ここから本文 -->
<!-- スケジュール管理 -->
<h3><div class="headline1" id="linux_1">スケジュール管理</div></h3>
<h4><div class="headline2" id="linux_1_1">crontabに登録する</div></h4>
<div class="text1">
ログインしているアカウントのcronに登録する場合
<pre>% crontab -e</pre>
編集画面が現れるので、次のように設定する。
<pre>分 時 日 月 週の何日目&nbsp; コマンド名</pre>
<ul class="list1">
<li>毎日8時45分にget.shスクリプトを動かす
<pre>
45 08 * * *  get.sh &gt; /dev/null 2&gt;& 1
</pre>
＊/dev/nullに渡して通知されないようにする
＊2は標準エラー出力を表し、標準出力の1と一緒に出力するので両方が破棄される
</li><br />
<li>毎月1日にget.shスクリプトを動かす
<pre>
45 08 1 * *  get.sh &gt; /dev/null 2&gt;& 1
</pre></li>
<li>毎週日曜にget.shスクリプトを動かす
<pre>
45 08 * * 0  get.sh &gt; /dev/null 2&gt;& 1
</pre>
0が日曜、1が月曜、2が火曜、3が水曜、4が木曜、5が金曜、6が土曜
</li><br />
<li>10分毎にスクリプトを動かす
<pre>
00,10,20,30,40,50  * * * *  get.sh &gt; /dev/null 2&gt;& 1
</pre></li>
</ul>
</div>

<h4><div class="headline2" id="linux_1_2">ユーザを指定してcrontabに登録する</div></h4>
<div class="text1">
/etc/crontabを編集する
<pre>分 時 日 月 週の何日目&nbsp; ユーザ名&nbsp; コマンド名</pre>
毎日50分に、clamupdateユーザ権限でウイルスデータベースを自動更新しログ保存
<pre>
50  * * * *  clamupdate /usr/bin/freshclam --quiet -l /var/log/clam-update.log
</pre>
</div>

<h4><div class="headline2" id="linux_1_3">crontabで月末に実行する</div></h4>
<div class="text1">
/etc/crontabを編集する
<pre>分 時 日 月 週の何日目&nbsp; ユーザ名&nbsp; コマンド名</pre>
dateコマンドを使い、次の日が1日だった場合に実行する。
<pre>
55　23　28-31 * * /usr/bin/test $( date -d '+1 day' +%d ) -eq 1 && 実行したいコマンド
</pre>
＊「+%d」は月の中の何日目かを表す値（01-31）<br />
<a href="https://www.server-memo.net/tips/command/date/date.html">dateコマンドで日付や時刻を表示したり設定する方法 </a>
</div>


<!-- メモリ使用量 -->
<h3><div class="headline1" id="linux_2">メモリ使用量</div></h3>
<h4><div class="headline2" id="linux_2_1">プロセス毎の詳細なメモリ使用量を調べる</div></h4>
<div class="text1">
ps -efでプロセスIDを調べ、pmapコマンドを用いる
<pre>% pmap -x プロセスID</pre>
</div>

<h4><div class="headline2" id="linux_2_2">実行時に確保するメモリ領域毎のサイズを表示</div></h4>
<div class="text1">
ps -efで実行中のプロセスとして表示されるプロセスのバイナリへのパスを調べておく。
<pre>% size 調べたいプロセスのバイナリへのパス</pre>
</div>


<!-- emacs関連 -->
<h3><div class="headline1" id="emacs_1">emacs関連</div></h3>
<h4><div class="headline2" id="emacs_1_1">emacsでカーソル位置を保存する</div></h4>
<div class="text1">
emacsの設定ファイル（.emacs）に追記する
<ul class="list1">
<li>24.5まで
<pre>
(require 'saveplace)
(setq-default save-place t)
</pre></li>
<li>25.0以降
<pre>
(require 'saveplace)
(save-place-mode 1) 
</pre></li>
</ul>
</div>

<h4><div class="headline2" id="emacs_1_2">emacsで長い行を折り返す</div></h4>
<div class="text1">
長い行を折り返して表示
<pre>Function : toggle-truncate-lines</pre><br />
長い行を折り返す（改行が入る）
<pre>Function : auto-fill-mode</pre>
</div>

<h4><div class="headline2" id="emacs_1_3">emacsで矩形選択</div></h4>
<div class="text1">
矩形選択モードに切り替える
<pre>Function : rectangle-mark-mode</pre><br />
ショートカット
<pre>C-x SPC</pre>
</div>

<h4><div class="headline2" id="emacs_1_4">emacsで末尾のエスケープを揃える</div></h4>
<div class="text1">
reginを指定してから以下
<pre>Function : sh-backslash-region</pre>
</div>


<!-- vi関連 -->
<h3><div class="headline1" id="vi_1">vi関連</div></h3>
<h4><div class="headline2" id="vi_1_1">viの基本的な操作</div></h4>
<div class="text1">
起動する場合、端末を開き
<pre>% vi</pre>
コマンド入力モードの基本的な操作一覧
<ul class="list1">
<li>viの終了
<pre>
:q &nbsp; 保存しないで終了
:q! &nbsp; 強制終了
ZZ &nbsp; 保存して終了
</pre>
（挿入モードになっている場合、ESCでコマンド入力モードに切り替える）</li><br />
<li>カーソルの移動（隣接する場所）
<pre>
h, j, k, l &nbsp; 左、下、上、右
</pre>
＊隣接するhjklキーに人差指から小指までを置いて操作
</li><br />
<li>カーソルの移動（離れた場所）
<pre>
0 &nbsp; 行頭に移動
$ &nbsp; 行末に移動
[[ &nbsp; 文頭に移動
]] &nbsp; 文末に移動
50G &nbsp; 50行目に移動
:50 &nbsp; 50行目に移動
10| &nbsp; 現在の行の10文字目に移動
E &nbsp; 単語の末尾に移動
B &nbsp; 単語の先頭に移動
fT &nbsp; 現在の行のカーソルより後ろにある文字Tに移動
FT &nbsp; 現在の行のカーソルより前にある文字Tに移動
</pre>
</li>
<li>挿入
<pre>
i &nbsp; カーソルのある位置に挿入
I &nbsp; 文頭に挿入（カーソルが行の途中にある場合に便利）
a &nbsp; カーソルの後ろに挿入（行末にカーソルがあり、後ろに追加する場合に必要）
A &nbsp; 文末に挿入（カーソルが行の途中にある場合に便利）
o &nbsp; カーソルの下に新しい行を挿入し、その行を編集
</pre>
</li>
<li>やり直し（アンドゥ）
<pre>
u &nbsp; 直前の動作を取り消
</pre>
</li>
<li>削除
<pre>
x &nbsp; 1文字削除
3x &nbsp; 3文字削除
dd &nbsp; 1行削除（d1dの省略型） 
d5d &nbsp; 5行削除
dw &nbsp; 1単語削除（d1wの省略型）
d$ &nbsp; 行末まで削除
d]] &nbsp; 文末まで削除
:10,20d &nbsp; 10から20行目までを削除
</pre>
</li>
<li>コピー
<pre>
yy &nbsp; 1行コピー（y1yの省略型）
y3y &nbsp; 3行コピー
yw &nbsp; 1単語コピー（y1wの省略型）
y$ &nbsp; 行末までコピー
y]] &nbsp; 文末までコピー
:10,20y &nbsp; 10から20行目までをコピー
</pre>
</li>
<li>貼り付け
<pre>
p &nbsp; 直前のコピー、削除でバッファに入った内容を貼り付け
</pre>
</li>
<li>行の連結
<pre>
J &nbsp; 現在カーソルがある行に次の行を連結する
</pre>
＊一度改行したら、この方法でしか戻せない
</li><br />
<li>検索
<pre>
:/word &nbsp; 文字列wordを順方向に検索
:?word &nbsp; 文字列wordを逆方向に検索
</pre>
</li>
<li>置換
<pre>
r &nbsp; カーソルの文字をrの次にタイプする文字に置き換え（挿入モードに移ることなく文章を編集できる）
:%s/word1/word2/g &nbsp; 文章中のword1を全てword2に
:%s/word1/word2/ &nbsp; 行の先頭にあるword1をword2に
:%s/word1/word2/c &nbsp; 置換の前に確認する場合
:10,50s/word1/word2/g &nbsp; 10から50行目のword1を全てword2に
</pre>
</li>
<li>ファイル操作
<pre>
:10,30w newfile &nbsp; 10-30行目をnewfileに書き込み
:.,$w &lt;&lt; file &nbsp; 現在の行から文末までをfileに追加書き込み
</pre>
</li>
</ul>
</div>

<h4><div class="headline2" id="vi_1_2">viの設定変更</div></h4>
<div class="text1">
コマンド入力モードで操作する。ホームディレクトリの.exrcに記載すると、毎回反映される。
<ul class="list1">
<li>括弧の対応を表示する
<pre>set showmatch</pre>
</li>
<li>大文字／小文字を区別しない
<pre>set ignorecase</pre>
</li>
<li>自動インデント機能を有効にする
<pre>set autoindent</pre>
</li>
<li>カーソルがある行・列を表示する
<pre>set ruler</pre>
</li>
<li>挿入モードの時に画面の下に表示が出るようにする
<pre>set showmode</pre>
</li>
<li>ソースコードの文法を解釈して表示する
<pre>syntax on</pre>
</li>
<li>バックアップファイルを作らない
<pre>set nobackup</pre>
</li>
</ul>
</div>


<!-- awk関連 -->
<h3><div class="headline1" id="awk_1">awk関連</div></h3>
<h4><div class="headline2" id="awk_1_1">列を取り出す</div></h4>
<div class="text1">
ファイルから1列目、2列目を取り出す
<pre>awk '{print $1, $2}' ファイル名</pre>
</div>

<h4><div class="headline2" id="awk_1_2">書式を指定する</div></h4>
<div class="text1">
printfを用いる
<ul class="list1">
<li>小数点第２位まで出力する
<pre>
echo 5.3 | awk '{printf "%.2f¥n", $1}'
出力：
&nbsp; &nbsp; 5.30
</pre>
</li><br />
<li>小数点以下3桁、9文字分で表示する（右詰めで左側に空白）
<pre>
echo 5.3 | awk '{printf "%9.3f¥n", $1}'
出力：
&nbsp; &nbsp; 5.300
</pre>
</li><br />
<li>左詰めにする場合
<pre>
echo 5.3 | awk '{printf "%-9.3f¥n", $1}'
出力：
&nbsp; &nbsp; 5.300
</pre>
</li><br />
</ul>
</div>


<!-- ネットワーク関連 -->
<h3><div class="headline1" id="network_1">ネットワーク関連</div></h3>
<h4><div class="headline2" id="network_1_1">IPアドレスを確認する</div></h4>
<div class="text1">
<ul class="list1">
<li>ipコマンド（Linux）
<pre>% ip addr（または% ip a）</pre>
＊標準的に入っている<br />
他の使い方は<a href="https://atmarkit.itmedia.co.jp/ait/articles/1709/22/news019.html">【 ip 】コマンド</a>参照
</li><br />
<li>ifconfigコマンド（Linux/macOS）
<pre>% ifconfig</pre>
＊Linuxでは、net-toolsパッケージに入っている
</li><br />
</ul>
</div>

<h4><div class="headline2" id="network_1_2">ネットワークデバイスを表示する</div></h4>
<div class="text1">
<pre>% ip link</pre>
＊Linuxの場合
</div>

<h4><div class="headline2" id="network_1_3">ルーティングテーブルの内容を表示する</div></h4>
<div class="text1">
<ul class="list1">
<li>ipコマンド（Linux）
<pre>% ip route</pre>
＊IPv6のテーブルを表示したい場合はip -6 route
</li><br />
<li>routeコマンド（Linux）
<pre>% route</pre>
＊IPv6のテーブルを表示したい場合はroute -6
</li><br />
<li>netstatコマンド（Linux/macOS）
<pre>% netstat -rn</pre>
</li>
＊Linuxでは非推奨でip routeを使う<br />
</ul>
</div>

<h4><div class="headline2" id="network_1_4">通信の状態を調べる</div></h4>
<div class="text1">
<ul class="list1">
<li>到達確認（Linux/macOS/Windows）
<pre>% ping IPアドレス</pre>
＊双方向にパケットが到達することを確認<br />
＊デフォルトゲートウェイ、DNSサーバ等のIPアドレスを入力し到達確認<br />
＊IPアドレスの代わりにDNSアドレスも利用可能だが、DNSサーバが正常に応答している時のみ使用したほうが良い
</li><br />
<li>DNSサーバの応答確認（Linux/macOS）
<pre>% nslookup IPアドレスまたはDNSアドレス</pre>
＊IPアドレスからDNSアドレス、DNSアドレスからIPアドレスが返ってくることを確認<br />
</li><br />
</ul>
</div>

<h4><div class="headline2" id="network_1_5">LISTENポートをチェックする</div></h4>
<div class="text1">
TCPのLISTENポートをチェックする
<pre>% ss -napt</pre>
UDPのLISTENポートをチェックする
<pre>% ss -napu</pre>
他の使い方は<a href="https://atmarkit.itmedia.co.jp/ait/articles/1710/06/news014.html">【 ss 】コマンド</a>参照
</div>

<h4><div class="headline2" id="network_1_6">サービス一覧を表示する</div></h4>
<div class="text1">
<pre>% systemctl -t service</pre>
＊/usr/lib/systemd/system/を参照している<br />
全サービスの一覧
<pre>% systemctl list-unit-files -t service</pre>
</div>


<!-- ユーザ管理 -->
<h3><div class="headline1" id="user_1">ユーザ管理</div></h3>
<h4><div class="headline2" id="user_1_1">ユーザを追加する</div></h4>
<div class="text1">
<pre># adduser ユーザ名</pre>
ユーザID（UID）を指定する場合
<pre># adduser ユーザ名 --uid UID</pre>
ユーザ作成と同時にwheelグループに追加する場合
<pre># adduser -G ユーザ名 </pre>
</div>

<h4><div class="headline2" id="user_1_2">グループを追加する</div></h4>
<div class="text1">
<pre># groupadd グループ名</pre>
グループID（GID）を指定する場合
<pre># groupadd グループ名 -g GID</pre>
</div>

<h4><div class="headline2" id="user_1_3">ユーザをグループに追加する</div></h4>
<div class="text1">
<pre># gpasswd -a ユーザ名 グループ名</pre>
</div>


<!-- システム管理 -->
<h3><div class="headline1" id="system_1">システム管理</div></h3>
<h4><div class="headline2" id="system_1_1">ログ通知</div></h4>
<div class="text1">
Logwatchをインストールする（RedHat系8以降）
<pre># dnf -y install logwatch</pre>
通知先のメールアドレスを設定する<br />
 /usr/share/logwatch/default.conf/logwatch.confを編集
<pre>
# MailTo = root
MailTo = 配信先のメールアドレス
</pre>
外部メールへの送信も行う場合は以下も必要
<pre># dnf -y install postfix</pre>
</div>


<!-- SSH関連 -->
<h3><div class="headline1" id="ssh_1">SSH関連</div></h3>
<h4><div class="headline2" id="ssh_1_1">ホスト公開鍵の更新</div></h4>
<div class="text1">
SSHホストが更新された際、ホスト公開鍵が以前のものと異なるため警告が出てログインできなくなる。
<pre>% ssh-keygen -R ホスト名</pre>
でリセット可能<br />
 $HOME/.ssh/known_hostsを編集して該当するホストの行を削除しても同じ
</div>

<h4><div class="headline2" id="ssh_1_2">SSH秘密鍵と公開鍵の新規生成</div></h4>
<div class="text1">
<pre>% ssh-keygen</pre>
＊デフォルトは暗号化形式rsa、ビット数は2048bit<br />
詳細なオプションは<a href="https://atmarkit.itmedia.co.jp/ait/articles/1908/02/news015.html">コマンド――SSHの公開鍵と秘密鍵を作成する</a>参照<br />
＊公開鍵は見せても良いが、秘密鍵は所有者のみが管理する
</div>

<h4><div class="headline2" id="ssh_1_3">ユーザー名を指定してログイン</div></h4>
<div class="text1">
<pre>% ssh hostname -l ユーザー名</pre>
</div>

<h4><div class="headline2" id="ssh_1_4">秘密鍵を指定してログイン</div></h4>
<div class="text1">
<pre>% ssh hostname -i ~/.ssh/秘密鍵のファイル名 </pre>
＊秘密鍵のパスフレーズを入力する
</div>

<h4><div class="headline2" id="ssh_1_5">X11転送を有効</div></h4>
<div class="text1">
sshコマンドに-Xオプションを与える（ForwardX11有効）
<pre>% ssh -X hostname</pre>
＊接続先ホストのsshd設定（/etc/ssh/sshd_config等）でForwardX11が無効にされている場合は利用できない<br />
emacsなど一部のアプリケーションはForwardX11Trustedも有効にしていないと動作しない。その場合には-Yオプションを付ける
<pre>% ssh -Y hostname</pre>
</div>

<h4><div class="headline2" id="ssh_1_6">configファイルを使ってログイン</div></h4>
<div class="text1">
&sim;/.ssh/configに記述する
<pre>Host 接続先ホスト名の略称等
&nbsp; &nbsp; Hostname IPアドレスまたはドメイン名
&nbsp; &nbsp; user ログインユーザ名
&nbsp; &nbsp; IdentityFile ~/.ssh/秘密鍵のファイル名
</pre>
次のコマンドで秘密鍵を指定したログインが可能
<pre>% ssh 接続先ホスト名の略称等</pre>
</div>

<h4><div class="headline2" id="ssh_1_7">カスケード接続</div></h4>
<div class="text1">
&sim;/.ssh/configに記述する
<pre>Host 踏み台サーバの略称等
&nbsp; &nbsp; Hostname 踏み台サーバのIPアドレスまたはドメイン名
&nbsp; &nbsp; user 踏み台サーバのログインユーザ名
&nbsp; &nbsp; IdentityFile &sim;/.ssh/秘密鍵のファイル名
&nbsp;
Host 接続先ホスト名の略称等
&nbsp; &nbsp; Hostname IPアドレスまたはドメイン名
&nbsp; &nbsp; user ログインユーザ名
&nbsp; &nbsp; ProxyCommand ssh -W %h:%p 踏み台サーバの略称等
&nbsp; &nbsp; IdentityFile &sim;/.ssh/秘密鍵のファイル名
</pre>
次のコマンドで秘密鍵を指定したカスケード接続が可能（秘密鍵のパスフレーズを2回入力する）
<pre>% ssh 接続先ホスト名の略称等</pre>
</div>

<h4><div class="headline2" id="ssh_1_8">ポートフォワード</div></h4>
<div class="text1">
<ul class="list1">
<li>sshコマンドに-Rオプションを付ける場合<br />
例：sshログイン先の8000番ポートをローカルの8001番に転送
<pre>ssh 接続先 -R8000:localhost:8001 -f -N -C</pre>
＊sshをバックグラウンドで実行（-f）、リモートでコマンドを実行しない（-N）、圧縮を有効（-C）</li><br />
<li>&sim;/.ssh/configに記述する場合
<pre>Host 接続先ホスト名の略称等
&nbsp; &nbsp; Hostname IPアドレスまたはドメイン名
&nbsp; &nbsp; user ログインユーザ名
&nbsp; &nbsp; IdentityFile ~/.ssh/秘密鍵のファイル名
&nbsp; &nbsp; LocalForward 8000 localhost:8001
</pre>
次のコマンドで秘密鍵を指定したポートフォワードが可能
<pre>% ssh -f -N -C 接続先ホスト名の略称等</pre>
</li><br />
</ul>
</div>

<h4><div class="headline2" id="ssh_1_9">sshdがLISTENするポートを指定する</div></h4>
<div class="text1">
/etc/ssh/sshd_configに記述する
<pre>
Port 22
Port 22222
</pre>
通常の22番ポートに加えて22222番ポートをLISTENする場合<br />
設定を有効にする
<pre>% systemctl reload sshd.service</pre>
接続する場合
<pre>% ssh -p 22222 接続先ホスト名の略称等</pre>
</div>


<!-- bash関連 -->
 <h3><div class="headline1" id="bash_1">bash関連</div></h3>
<h4><div class="headline2" id="bash_1_1">配列の作成</div></h4>
<div class="text1">
<pre>配列名=(値1 値2 値3)</pre>
例：配列を作成し中身を表示する
<pre>
% array=(var1 var2 var3)
% echo ${array[@]}
var1 var2 var3
% echo ${array}
var1
% echo ${array[0]}
var1
% echo ${array[1]}
var2
</pre>
</div>

<h4><div class="headline2" id="bash_1_2">配列の値の変更、配列への追加</div></h4>
<div class="text1">
作成した配列の要素を置き換える場合
<pre>
% array=(var1 var2 var3)
% array[2]=hoge
% echo ${array[@]}
var1 var2 hoge
</pre>
要素を追加する場合
<pre>
% array=(var1 var2 var3)
% array[3]=var4
% echo ${array[@]}
var1 var2 var3 var4
</pre>
＊要素数が3の時にarray[4]に追加した場合、array[3]に追加される
</div>

<h4><div class="headline2" id="bash_1_3">配列の要素数を表示する</div></h4>
<div class="text1">
次のように配列の要素数を表示できる。
<pre>
% array=(var1 var2 var3)
% echo ${#array[@]}
</pre>
</div>

<h4><div class="headline2" id="bash_1_4">配列の要素を順に利用する</div></h4>
<div class="text1">
次のようにforループを使い、要素を順に利用する（スクリプトに記載）。
<pre>
#!/bin/bash
array=(var1 var2 var3)
for arr in ${array[@]}
do
&nbsp; echo ${arr}
done
</pre>
要素数が同じ複数配列の場合は、whileループを使う。
<pre>
#!/bin/bash
array1=(var11 var12 var13)
array2=(var21 var22 var23)
n=0
while test n -lt ${#array1[@]}
do
&nbsp; arr1=array1[$n]
&nbsp; arr2=array2[$n]
&nbsp; echo ${arr1} ${arr2}
&nbsp; n=`expr ${n} + 1`
done
</pre>
</div>

<h4><div class="headline2" id="bash_1_5">コマンドの結果を配列に入力する</div></h4>
<div class="text1">
次のようにバックスラッシュで囲む。
<pre>
% array=`command options`
</pre>
次のように記述することも可能。
<pre>
% array=$(command options)
</pre>
パイプでつなげた結果を使うことも可能。
<pre>
% array=$(command1 options| command2 options)
</pre>
標準エラー出力も標準出力に。
<pre>
% array=$(command1 options| command2 options 2&gt;&amp;1)
</pre>
</div>

<h4><div class="headline2" id="bash_1_6">リダイレクト</div></h4>
<div class="text1">
コマンドへの入力やコマンドの出力等を扱う時に利用する。
<ul class="list1">
<li>例：lsコマンドの出力をファイルに書き出す
<pre>% ls &gt; file </pre>
</li>
<li>例：複数ディレクトリに対するlsコマンドの出力をファイルに書き出す
<pre>
% ls ディレクトリ1 &gt; file 
% ls ディレクトリ2 &gt;&gt; file 
</pre>
</li>
<li>例：コマンドの標準出力／標準エラー出力を同一ファイルに書き出す（その１）
<pre>% コマンド &amp;&gt; file </pre>
</li>
<li>例：コマンドの標準出力／標準エラー出力を同一ファイルに書き出す（その２）
<pre>% コマンド &gt; file 2&gt;&amp;1</pre>
</li>
<li>例：コマンドの標準出力／標準エラー出力を捨てる
<pre>
% コマンド &gt;&amp; /dev/null
% コマンド &amp;&gt; /dev/null
% コマンド &gt; /dev/null 2&gt;&amp;1
% コマンド 1&gt; /dev/null 2&gt; /dev/null
</pre>
全て同じなので、使いやすいものを使う</li><br />
<li>例：コマンドへの入力
<pre>% コマンド &lt; オプションなど</pre>
</li>
<li>例：指定範囲までをcatコマンドに入力する
<pre>
% cat &lt;&lt;EOF
line1
line2
EOF
</pre></li>
<li>例：指定範囲までをファイルに入力する
<pre>
% cat &gt; test.txt&lt;&lt;EOF
line1
line2
EOF
</pre>
test.txtに内容が入る
</li><br />
</ul>
</div>

<h4><div class="headline2" id="bash_1_7">数字の桁</div></h4>
<div class="text1">
整数を5文字になるまで0埋めする
<pre>
n=3
nn=$(printf "%05d" ${n})
出力：00003
</pre>
小数点以下１位まで表示する
<pre>
n=3
nn=$(printf "%5.1f" ${n})
出力：3.0
</pre>
</div>


<!-- その他コマンド -->
<h3><div class="headline1" id="com_1">その他コマンド</div></h3>
<h4><div class="headline2" id="com_1_1">grepで該当行の前後２行を表示する</div></h4>
<div class="text1">
<pre>% grep -A 2 -B 2 検索文字列</pre>
</div>

<h4><div class="headline2" id="com_1_2">diffを+-記号表示にする</div></h4>
<div class="text1">
<pre>% diff -U1 ファイル名1 ファイル名2</pre>
</div>

<h4><div class="headline2" id="com_1_3">nkfでUTF-8とLF形式にする</div></h4>
<div class="text1">
nkf（Network Kanji Filter）では文字コードの変換や改行コードの変換を行うことができる。次のように文字コードをUTF-8、改行コードをLF（¥n）に変換し、元のファイルを上書きする。
<pre>% nkf -w -Lu --overwrite ファイル名</pre>
</div>

<h4><div class="headline2" id="com_1_4">teeでmakeログを作成しながら画面表示</div></h4>
<div class="text1">
teeコマンドでは、パイプで渡された内容をファイルに書き出しながら画面にも表示することができる。makeの際にログファイルを残しながら表示するのに便利。
<pre>% make | tee ファイル名</pre>
</div>

<h4><div class="headline2" id="com_1_5">apgでパスワード自動生成</div></h4>
<div class="text1">
apg（Automated Password Generator）コマンドでは、複雑なパスワードを自動生成することができる。
<pre>% apg</pre>
デフォルトでは6種類の候補を表示する（-a0オプションがデフォルトで、発音できそうなものが選ばれる）。<br />
<pre>% apg -a1</pre>
ランダムなパスワードを表示する。
</div>


<small><a href="#top">[top]</a></small> <br />
<hr />
</article>
</body>
<footer>
<p>最終更新日：2023/10/01</p>
<p>Copyright (C) 2018-2023, Yousuke Yamashita, CC BY 4.0</p>
</footer>
</html>