<!doctype html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="author" content="山下陽介 (Yousuke Yamashita)  国立環境研究所 (National Institute for Environmental Studies, NIES)" />
<link rel="icon" href="/yousuke/favicon.ico" type="image/vnd.microsoft.icon" />
<!-- Mobile Internet Explorer allows us to activate ClearType technology for smoothing fonts for easy reading -->
<meta http-equiv="cleartype" content="on" />
<!-- Specify whether or not telephone numbers in the HTML content should appear as hypertext links -->
<meta name="format-detection" content="telephone=no" />
<!-- Changes the logical window size used when displaying a page mobile browsers -->
<meta name = "viewport" content = "width = device-width, initial-scale=1, user-scalable=yes" />

<meta name="robots" content="nofollow" />
<meta name="http-equiv" content="X-Robots-Tag : nofollow" />
<meta name="googlebot" content="nofollow" />
<meta name="description" content="" />
<meta name="keywords" content="crontab" />
<link href="design_keisannki.css" rel="stylesheet" type="text/css" />
<title>計算機TIPS</title>
</head>

<!--<body link="#CC00FF" vlink="#CC00FF">-->
<body link="#0000FF" vlink="#0000FF">
<div id="nesting">
<a href="/~yyousuke">ホーム</a> &gt; <a href="/~yyousuke/yousuke/index.html">山下のページ</a>  &gt; <a href="/~yyousuke/yousuke/keisannki/index.html">計算機関連</a> &gt; TIPS
</div>
<article>
<h1>計算機TIPS</h1>
<br />
<p>&nbsp; ここでは、主にLinux系の計算機におけるTIPSを載せています。まだ正式公開版ではなくメモ書き程度ですので、その点に留意して頂ければ幸いです。コマンド入力の説明では、%が一般ユーザのプロンプトを、#がrootのプロンプトを表しています。</p>
<br /><hr />

<!-- 目次 -->

<h2 id="contents">目次</h2>
<div class="contents">
  <!-- スケジュール管理 -->
  <ul class="list1"><li><a href="#linux_1">スケジュール管理</a>
    <ul class="list2">
      <li><a href="#linux_1_1">crontabに登録する</a></li>
      <li><a href="#linux_1_2">ユーザを指定してcrontabに登録する</a></li>
      <li><a href="#linux_1_3">crontabで月末に実行する</a></li>
  </ul>
  </li></ul>
  <!-- メモリ使用量 -->
  <ul class="list1"><li><a href="#linux_2">メモリ使用量</a>
    <ul class="list2">
      <li><a href="#linux_2_1">プロセス毎の詳細なメモリ使用量を調べる</a></li>
      <li><a href="#linux_2_2">実行時に確保するメモリ領域毎のサイズを表示</a></li>
  </ul>
  </li></ul>
  <!-- emacs関連 -->
  <ul class="list1"><li><a href="#emacs_1">emacs関連</a>
    <ul class="list2">
      <li><a href="#emacs_1_1">emacsでカーソル位置を保存する</a></li>
      <li><a href="#emacs_1_2">emacsで長い行を折り返す</a></li>
      <li><a href="#emacs_1_3">emacsで矩形選択</a></li>
      <li><a href="#emacs_1_4">emacsで末尾のエスケープを揃える</a></li>
  </ul>
  </li></ul>
  <!-- ネットワーク関連 -->
  <ul class="list1"><li><a href="#network_1">ネットワーク関連</a>
    <ul class="list2">
      <li><a href="#network_1_1">IPアドレスを確認する</a></li>
      <li><a href="#network_1_2">ネットワークデバイスを表示する</a></li>
      <li><a href="#network_1_3">ルーティングテーブルの内容を表示する</a></li>
      <li><a href="#network_1_4">通信の状態を調べる</a></li>
      <li><a href="#network_1_5">LISTENポートをチェックする</a></li>
      <li><a href="#network_1_6">サービス一覧を表示する</a></li>
  </ul>
  </li></ul>
  <!-- ユーザ管理 -->
  <ul class="list1"><li><a href="#user_1">ユーザ管理</a>
    <ul class="list2">
      <li><a href="#user_1_1">ユーザを追加する</a></li>
      <li><a href="#user_1_2">グループを追加する</a></li>
      <li><a href="#user_1_3">ユーザをグループに追加する</a></li>
  </ul>
  </li></ul>
  <!-- その他コマンド -->
  <ul class="list1"><li><a href="#com_1">その他コマンド</a>
    <ul class="list2">
      <li><a href="#com_1_1">grepで該当行の前後２行を表示する</a></li>
      <li><a href="#com_1_2">diffを+-記号表示にする</a></li>
      <li><a href="#com_1_3">nkfでUTF-8とLF形式にする</a></li>      
  </ul>
  </li></ul>
</div>

<small><a href="#top">[top]</a></small> <br />
<br />
<hr width="105%" />
<br />


<!-- ここから本文 -->
<!-- スケジュール管理 -->
<h3><div class="headline1" id="linux_1">スケジュール管理</div></h3>
<h4><div class="headline2" id="linux_1_1">crontabに登録する</div></h4>
<div class="text1">
ログインしているアカウントのcronに登録する場合
<pre>% crontab -e</pre>
編集画面が現れるので、次のように設定する。
<pre>分 時 日 月 週の何日目&nbsp; コマンド名</pre>
<ul class="list1">
<li>毎日8時45分にget.shスクリプトを動かす
<pre>
45 08 * * *  get.sh &gt; /dev/null 2&gt;& 1
</pre>
＊/dev/nullに渡して通知されないようにする
＊2は標準エラー出力を表し、標準出力の1と一緒に出力するので両方が破棄される
</li><br />
<li>毎月1日にget.shスクリプトを動かす
<pre>
45 08 1 * *  get.sh &gt; /dev/null 2&gt;& 1
</pre></li>
<li>毎週日曜にget.shスクリプトを動かす
<pre>
45 08 * * 0  get.sh &gt; /dev/null 2&gt;& 1
</pre>
0が日曜、1が月曜、2が火曜、3が水曜、4が木曜、5が金曜、6が土曜
</li><br />
<li>10分毎にスクリプトを動かす
<pre>
00,10,20,30,40,50  * * * *  get.sh &gt; /dev/null 2&gt;& 1
</pre></li>
</ul>
</div>

<h4><div class="headline2" id="linux_1_2">ユーザを指定してcrontabに登録する</div></h4>
<div class="text1">
/etc/crontabを編集する
<pre>分 時 日 月 週の何日目&nbsp; ユーザ名&nbsp; コマンド名</pre>
毎日50分に、clamupdateユーザ権限でウイルスデータベースを自動更新しログ保存
<pre>
50  * * * *  clamupdate /usr/bin/freshclam --quiet -l /var/log/clam-update.log
</pre>
</div>

<h4><div class="headline2" id="linux_1_3">crontabで月末に実行する</div></h4>
<div class="text1">
/etc/crontabを編集する
<pre>分 時 日 月 週の何日目&nbsp; ユーザ名&nbsp; コマンド名</pre>
dateコマンドを使い、次の日が1日だった場合に実行する。
<pre>
55　23　28-31 * * /usr/bin/test $( date -d '+1 day' +%d ) -eq 1 && 実行したいコマンド
</pre>
</div>


<!-- メモリ使用量 -->
<h3><div class="headline1" id="emacs_2">メモリ使用量</div></h3>
<h4><div class="headline2" id="emacs_2_1">プロセス毎の詳細なメモリ使用量を調べる</div></h4>
<div class="text1">
ps -efでプロセスIDを調べ、pmapコマンドを用いる
<pre>% pmap -x プロセスID</pre>
</div>

<h4><div class="headline2" id="emacs_2_2">実行時に確保するメモリ領域毎のサイズを表示</div></h4>
<div class="text1">
ps -efで実行中のプロセスとして表示されるプロセスのバイナリへのパスを調べておく。
<pre>% size 調べたいプロセスのバイナリへのパス</pre>
</div>


<!-- emacs関連 -->
<h3><div class="headline1" id="emacs_1">emacs関連</div></h3>
<h4><div class="headline2" id="emacs_1_1">emacsでカーソル位置を保存する</div></h4>
<div class="text1">
emacsの設定ファイル（.emacs）に追記する
<ul class="list1">
<li>24.5まで
<pre>
(require 'saveplace)
(setq-default save-place t)
</pre></li>
<li>25.0以降
<pre>
(require 'saveplace)
(save-place-mode 1) 
</pre></li>
</ul>
</div>

<h4><div class="headline2" id="emacs_1_2">emacsで長い行を折り返す</div></h4>
<div class="text1">
長い行を折り返して表示
<pre>Function : toggle-truncate-lines</pre><br />
長い行を折り返す（改行が入る）
<pre>Function : auto-fill-mode</pre>
</div>

<h4><div class="headline2" id="emacs_1_3">emacsで矩形選択</div></h4>
<div class="text1">
矩形選択モードに切り替える
<pre>Function : rectangle-mark-mode</pre><br />
ショートカット
<pre>C-x SPC</pre>
</div>

<h4><div class="headline2" id="emacs_1_4">emacsで末尾のエスケープを揃える</div></h4>
<div class="text1">
reginを指定してから以下
<pre>Function : sh-backslash-region</pre>
</div>


<!-- ネットワーク関連 -->
<h3><div class="headline1" id="network_1">ネットワーク関連</div></h3>
<h4><div class="headline2" id="network_1_1">IPアドレスを確認する</div></h4>
<div class="text1">
<ul class="list1">
<li>ipコマンド（Linux）
<pre>% ip addr（または% ip a）</pre>
＊標準的に入っている<br />
他の使い方は<a href="https://atmarkit.itmedia.co.jp/ait/articles/1709/22/news019.html">【 ip 】コマンド</a>参照
</li><br />
<li>ifconfigコマンド（Linux/macOS）
<pre>% ifconfig</pre>
＊Linuxでは、net-toolsパッケージに入っている
</li><br />
</ul>
</div>

<h4><div class="headline2" id="network_1_2">ネットワークデバイスを表示する</div></h4>
<div class="text1">
<pre>% ip link</pre>
＊Linuxの場合
</div>

<h4><div class="headline2" id="network_1_3">ルーティングテーブルの内容を表示する</div></h4>
<div class="text1">
<ul class="list1">
<li>ipコマンド（Linux）
<pre>% ip route</pre>
＊IPv6のテーブルを表示したい場合はip -6 route
</li><br />
<li>ifconfigコマンド（Linux）
<pre>% route</pre>
＊IPv6のテーブルを表示したい場合はroute -6
</li><br />
<li>netstatコマンド（Linux/macOS）
<pre>% netstat -rn</pre>
</li>
＊Linuxでは非推奨でip routeを使う<br />
</ul>
</div>

<h4><div class="headline2" id="network_1_4">通信の状態を調べる</div></h4>
<div class="text1">
<ul class="list1">
<li>到達確認（Linux/macOS/Windows）
<pre>% ping IPアドレス</pre>
＊双方向にパケットが到達することを確認<br />
＊デフォルトゲートウェイ、DNSサーバ等のIPアドレスを入力し到達確認<br />
＊IPアドレスの代わりにDNSアドレスも利用可能だが、DNSサーバが正常に応答している時のみ使用したほうが良い
</li><br />
<li>DNSサーバの応答確認（Linux/macOS）
<pre>% nslookup IPアドレスまたはDNSアドレス</pre>
＊IPアドレスからDNSアドレス、DNSアドレスからIPアドレスが返ってくることを確認<br />
</li><br />
</ul>
</div>

<h4><div class="headline2" id="network_1_5">LISTENポートをチェックする</div></h4>
<div class="text1">
TCPのLISTENポートをチェックする
<pre>% ss -napt</pre>
UDPのLISTENポートをチェックする
<pre>% ss -napu</pre>
他の使い方は<a href="https://atmarkit.itmedia.co.jp/ait/articles/1710/06/news014.html">【 ss 】コマンド</a>参照
</div>

<h4><div class="headline2" id="network_1_6">サービス一覧を表示する</div></h4>
<div class="text1">
<pre>% systemctl -t service</pre>
＊/usr/lib/systemd/system/を参照している<br />
全サービスの一覧
<pre>% systemctl list-unit-files -t service</pre>
</div>



<!-- ユーザ管理 -->
<h3><div class="headline1" id="user_1">ユーザ管理</div></h3>
<h4><div class="headline2" id="user_1_1">ユーザを追加する</div></h4>
<div class="text1">
<pre>% adduser ユーザ名</pre>
</div>

<h4><div class="headline2" id="user_1_2">グループを追加する</div></h4>
<div class="text1">
<pre>% groupadd グループ名</pre>
</div>

<h4><div class="headline2" id="user_1_3">ユーザをグループに追加する</div></h4>
<div class="text1">
<pre>% gpasswd -a ユーザ名 グループ名</pre>
</div>



<!-- その他コマンド -->
<h3><div class="headline1" id="com_1">その他コマンド</div></h3>
<h4><div class="headline2" id="com_1_1">grepで該当行の前後２行を表示する</div></h4>
<div class="text1">
<pre>% grep -A 2 -B 2 検索文字列</pre>
</div>

<h4><div class="headline2" id="com_1_2">diffを+-記号表示にする</div></h4>
<div class="text1">
<pre>% diff -U1 ファイル名1 ファイル名2</pre>
</div>

<h4><div class="headline2" id="com_1_3">nkfでUTF-8とLF形式にする</div></h4>
<div class="text1">
nkf（Network Kanji Filter）では文字コードの変換や改行コードの変換を行うことができる。次のように文字コードをUTF-8、改行コードをLF（¥n）に変換し、元のファイルを上書きする。
<pre>% nkf -w -Lu --overwrite ファイル名</pre>
</div>

<small><a href="#top">[top]</a></small> <br />
<hr width="105%" />
</article>
</body>
<footer>
<p>最終更新日：2022/11/19</p>
<p>Copyright (C) 2018-2022, Yousuke Yamashita</p>
</footer>
</html>