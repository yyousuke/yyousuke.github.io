<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>

<HEAD>
<meta http-equiv="refresh" content="300" >
<meta http-equiv="X-UA-Compatible" content="IE=edge" >
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="author" content="山下陽介 (Yousuke Yamashita)">
<link rel="icon" href="/yousuke/favicon.ico" type="image/x-icon" />
<!-- Mobile Internet Explorer allows us to activate ClearType technology for smoothing fonts for easy reading -->
<meta http-equiv="cleartype" content="on">
<!-- Specify whether or not telephone numbers in the HTML content should appear as hypertext links -->
<meta name="format-detection" content="telephone=no" />
<!-- Changes the logical window size used when displaying a page mobile browsers -->
<meta name = "viewport" content = "width = device-width, initial-scale=1, user-scalable=yes">

<meta name="robots" content="noindex, nofollow" />
<meta name="http-equiv" content="X-Robots-Tag : noindex, nofollow" />
<meta name="googlebot" content="noindex, nofollow" />
<META hame="description" content="Vine Linuxのカーネル交換を行なった際のメモです. ブートローダにはliloを使用しています.">
<TITLE>Linuxのkernel交換(lilo)</TITLE>
</HEAD>


<BODY link="#0000FF" vlink="#0000FF">
<CENTER><H1><B>kernelの交換</B></H1></CENTER>
<H3>
<P align="right">最終更新日 2005/06/04</P><BR>
ここでは、Linuxのkernelを交換した際の方法をメモしています。kernelのbug
fix版が時々公開されていますので、できればアップグレードしておきましょう。
</H3>
<HR>
<H3>
<DL>
<DT><LI><B>kernelの取得</B><BR>
<DD>aptが使えるシステムでは簡単にkernelを取得することができます。<BR><BR>
$ apt-get install kernel#2.4.27-0vl7.6 <BR><BR>
のようにバージョンを指定して取得します。
</DL>
<BR>
<DL>
<DT><LI><B>起動用imgファイルの作成</B><BR>
<DD>起動用imgファイルが自動的に作成されるシステムもありますが、作成されな
いシステムの場合にはmkinitrdを使って作成します。<BR><BR>
$ mkinitrd  /boot/initrd-2.4.27-0vl7.6.img  2.4.27-0vl7.6
</DL>
<BR>
<DL>
<DT><LI><B>ブートローダの設定</B><BR>
<DD>
ブート時に新しいkernelが読み込まれるようにブートローダの設定を行います。
ここではliloを使用した方法を紹介しています。GRUBを使用している場合には
<A href="http://park15.wakwak.com/~unixlife/linux/rpm-kernel_up.html" rel="nofollow">
次のページ</A>などを参考にして下さい。<BR>
現在のkernelが2.4.26-0vl15で、2.4.27-0vl7.6 (現在の2.4カーネルの最新版)
にアップグレードすることを考えているとします。また、/dev/hda5 を / に
/dev/hda3 を swap にマウントしています。<BR>
/etc/lilo.confを開き、<BR><BR>
----------------------------------------------------------------------<BR>
prompt<BR>
timeout=50 (kernelの選択画面を5秒間表示)<BR>
default=linux (デフォルトでlabel=linuxを起動)<BR>
boot=/dev/hda (ブートするディスク)<BR>
map=/boot/map (マップファイルの場所)<BR>
install=/boot/boot.b (boot loader の場所)<BR>
message=/boot/message<BR>
lba32<BR>
<BR>
image=/boot/vmlinuz-2.4.27-0vl7.6 (カーネルの場所を指定)<BR>
        label=linux (ブート時に表示されるラベルの名前)<BR>
        initrd=/boot/initrd-2.4.27-0vl7.6.img (起動用imgファイルの指定)<BR>
        read-only<BR>
        root=/dev/hda5 (ルートのファイルが存在するパーティションの指定)<BR>
        append=" resume2=swap:/dev/hda3" (/dev/hda3 をswap領域として使用)<BR>
<BR>
image=/boot/vmlinuz-2.4.26-0vl15<BR>
        label=linux-old<BR>
        initrd=/boot/initrd-2.4.26-0vl15.img<BR>
        read-only<BR>
        root=/dev/hda5<BR>
        append=" resume2=swap:/dev/hda3"<BR>
----------------------------------------------------------------------<BR>
のように2.4.27-0vl7.6を追加します。うまく起動しなかった場合を考えて2.4.26-0vl15の方はlinux-oldで起動できるようにしておきます。<BR><BR>
</DL>
<BR>

<DL>
<DT><LI><B>マップファイルの更新</B><BR>
<DD>/etc/lilo.confはブート時に読み込めないため、ここに記述したカーネル
を呼び込むための情報をマップファイルに入れて置き、bootloaderが起動時に
使用できるようにしておく必要があります。<BR><BR>
$ /sbin/lilo <BR><BR>
でマップファイルを更新します。<BR>
ブートの仕組みについて詳しく知りたい場合には<A
href="http://www.linux.or.jp/JF/JFdocs/inside-lilo.html" rel="nofollow">次のページ
</A>などを参考にして下さい。
</DL>
<BR>
<A href="#contents"></A>
</H3>

<BR><BR>
<HR>
<SCRIPT language="JavaScript" type="text/javascript" src="../intro/link.js"></SCRIPT>
<HR>


</BODY>
</HTML>
