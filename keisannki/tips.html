<!doctype html>
<html>
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M077D60Y90"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M077D60Y90');
</script>

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="author" content="山下陽介 (Yousuke Yamashita)  国立環境研究所 (National Institute for Environmental Studies, NIES)" />
<link rel="icon" type="image/vnd.microsoft.icon" href="/favicon.ico" />
<link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon-180x180.png" />
<link rel="icon" type="image/png" href="/icon-192x192.png" />
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<!-- Mobile Internet Explorer allows us to activate ClearType technology for smoothing fonts for easy reading -->
<meta http-equiv="cleartype" content="on" />
<!-- Specify whether or not telephone numbers in the HTML content should appear as hypertext links -->
<meta name="format-detection" content="telephone=no" />
<!-- Changes the logical window size used when displaying a page mobile browsers -->
<meta name = "viewport" content = "width = device-width, initial-scale=1, user-scalable=yes" />

<meta name="robots" content="nofollow" />
<meta name="http-equiv" content="X-Robots-Tag : nofollow" />
<meta name="googlebot" content="nofollow" />
<meta name="description" content="" />
<meta name="keywords" content="crontab" />
<link href="design_keisannki.css" rel="stylesheet" type="text/css" />
<title>計算機TIPS</title>
</head>

<body>
<div id="nesting">
<a href="/">ホーム</a> &gt; <a href="/keisannki/index.html">計算機関連</a> &gt; TIPS
</div>
<article>
<h1 id="top">計算機TIPS</h1>
<br />
<p>&nbsp; ここでは、主にLinux系の計算機におけるTIPSを載せています。まだ正式公開版ではなくメモ書き程度ですので、その点に留意して頂ければ幸いです。コマンド入力の説明では、%が一般ユーザのプロンプトを、#がrootのプロンプトを表しています。</p>
<br /><hr />

<!-- 目次 -->

<h2 id="contents">目次</h2>
<div class="contents">
  <!-- スケジュール管理 -->
  <ul class="list1"><li><a href="#linux_1">スケジュール管理</a>
    <ul class="list2">
      <li><a href="#linux_1_1">crontabに登録する</a></li>
      <li><a href="#linux_1_2">ユーザを指定してcrontabに登録する</a></li>
      <li><a href="#linux_1_3">crontabで月末に実行する</a></li>
  </ul>
  </li></ul>
  <!-- デバッグ関連 -->
  <ul class="list1"><li><a href="#linux_2">デバッグ関連</a>
    <ul class="list2">
      <li><a href="#linux_2_1">プロセス毎の詳細なメモリ使用量を調べる</a></li>
      <li><a href="#linux_2_2">実行時に確保するメモリ領域毎のサイズを表示</a></li>
      <li><a href="#linux_2_3">実行時にリンクされるライブラリを調べる</a></li>
  </ul>
  </li></ul>
  <!-- emacs関連 -->
  <ul class="list1"><li><a href="#emacs_1">emacs関連</a>
    <ul class="list2">
      <li><a href="#emacs_1_1">emacsでカーソル位置を保存する</a></li>
      <li><a href="#emacs_1_2">emacsで長い行を折り返す</a></li>
      <li><a href="#emacs_1_3">emacsで矩形選択</a></li>
      <li><a href="#emacs_1_4">emacsで末尾のエスケープを揃える</a></li>
  </ul>
  </li></ul>
  <!-- vi関連 -->
  <ul class="list1"><li><a href="#vi_1">vi関連</a>
    <ul class="list2">
      <li><a href="#vi_1_1">viの基本的な操作</a></li>
      <li><a href="#vi_1_2">viの設定変更</a></li>
  </ul>
  </li></ul>
  <!-- awk関連 -->
  <ul class="list1"><li><a href="#awk_1">awk関連</a>
    <ul class="list2">
      <li><a href="#awk_1_1">列を取り出す</a></li>
      <li><a href="#awk_1_2">演算を行う</a></li>
      <li><a href="#awk_1_3">書式を指定する</a></li>
      <li><a href="#awk_1_4">区切り文字を指定する</a></li>
  </ul>
  </li></ul>  
  <!-- ネットワーク関連 -->
  <ul class="list1"><li><a href="#network_1">ネットワーク関連</a>
    <ul class="list2">
      <li><a href="#network_1_1">IPアドレスを確認する</a></li>
      <li><a href="#network_1_2">ネットワークデバイスを表示する</a></li>
      <li><a href="#network_1_3">ルーティングテーブルの内容を表示する</a></li>
      <li><a href="#network_1_4">通信の状態を調べる</a></li>
      <li><a href="#network_1_5">LISTENポートをチェックする</a></li>
      <li><a href="#network_1_6">ARPテーブルを表示する</a></li>
  </ul>
  </li></ul>
  <!-- ユーザ管理 -->
  <ul class="list1"><li><a href="#user_1">ユーザ管理</a>
    <ul class="list2">
      <li><a href="#user_1_1">ユーザを追加する</a></li>
      <li><a href="#user_1_2">ユーザを削除する</a></li>
      <li><a href="#user_1_3">グループを追加する</a></li>
      <li><a href="#user_1_4">ユーザをグループに追加する</a></li>
      <li><a href="#user_1_5">ユーザをグループから削除する</a></li>
      <li><a href="#user_1_6">ユーザの所属するグループを変更する</a></li>
  </ul>
  </li></ul>
  <!-- システム管理 -->
  <ul class="list1"><li><a href="#system_1">システム管理</a>
    <ul class="list2">
      <li><a href="#system_1_1">ディスク使用量</a></li>
      <li><a href="#system_1_2">温度監視</a></li>
      <li><a href="#system_1_3">ログ通知</a></li>
      <li><a href="#system_1_4">サービス一覧を表示する</a></li>
      <li><a href="#system_1_5">サービスの管理</a></li>
      <li><a href="#system_1_6">サービスログの確認</a></li>
      <li><a href="#system_1_7">ランレベルの確認</a></li>
      <li><a href="#system_1_8">ランレベルの変更</a></li>
      <li><a href="#system_1_9">ディスク管理</a></li>
      <li><a href="#system_1_10">ファイアウォール</a></li>
      <li><a href="#system_1_11">パッケージ管理</a></li>
  </ul>
  </li></ul>
  <!-- OSアップデート -->
  <ul class="list1"><li><a href="#os_1">OSアップデート</a>
    <ul class="list2">
      <li><a href="#os_1_1">OpenSUSEのOSアップデート</a></li>
  </ul>
  </li></ul>
  <!-- SSH関連 -->
  <ul class="list1"><li><a href="#ssh_1">SSH関連</a>
    <ul class="list2">
      <li><a href="#ssh_1_1">ホスト公開鍵の更新</a></li>
      <li><a href="#ssh_1_2">SSH秘密鍵と公開鍵の新規生成</a></li>
      <li><a href="#ssh_1_3">ユーザー名を指定してログイン</a></li>
      <li><a href="#ssh_1_4">秘密鍵を指定してログイン</a></li>
      <li><a href="#ssh_1_5">X11転送を有効にする</a></li>
      <li><a href="#ssh_1_6">configファイルを使う</a></li>
      <li><a href="#ssh_1_7">カスケード接続</a></li>
      <li><a href="#ssh_1_8">ポートフォワード</a></li>
      <li><a href="#ssh_1_9">sshdがLISTENするポートを指定する</a></li>
      <li><a href="#ssh_1_10">sshdでパスワード試行回数を制限する</a></li>
  </ul>
  </li></ul>
  <!-- bash関連 -->
  <ul class="list1"><li><a href="#bash_1">bash関連</a>
    <ul class="list2">
      <li><a href="#bash_1_1">配列の作成</a></li>
      <li><a href="#bash_1_2">配列の値の変更、配列への追加</a></li>
      <li><a href="#bash_1_3">配列の要素数を表示する</a></li>
      <li><a href="#bash_1_4">配列の要素を順に利用する</a></li>
      <li><a href="#bash_1_5">コマンドの結果を配列に入力する</a></li>
      <li><a href="#bash_1_6">リダイレクト</a></li>
      <li><a href="#bash_1_7">数字の桁</a></li>
  </ul>
  </li></ul>
  <!-- ファイル関連 -->
  <ul class="list1"><li><a href="#file_1">ファイル/ディレクトリ関連</a>
    <ul class="list2">
      <li><a href="#file_1_1">空のファイル作成、タイムスタンプ更新</a></li>
      <li><a href="#file_1_2">ディレクトリ作成</a></li>
      <li><a href="#file_1_3">ファイル/ディレクトリのパーミッション</a></li>
      <li><a href="#file_1_4">setuidとsetgid</a></li>
      <li><a href="#file_1_5">ACLの設定</a></li>
      <li><a href="#file_1_6">ファイルの分割と分割ファイルの結合</a></li>
  </ul>
  </li></ul>
  <!-- 画像関連 -->
  <ul class="list1"><li><a href="#fig_1">画像関連</a>
    <ul class="list2">
      <li><a href="#fig_1_1">convertによるファイル形式変換</a></li>
  </ul>
  </li></ul>
  <!-- その他コマンド -->
  <ul class="list1"><li><a href="#com_1">その他コマンド</a>
    <ul class="list2">
      <li><a href="#com_1_1">grepで該当行の前後２行を表示する</a></li>
      <li><a href="#com_1_2">diffを+-記号表示にする</a></li>
      <li><a href="#com_1_3">nkfでUTF-8とLF形式にする</a></li>
      <li><a href="#com_1_4">teeでmakeログを作成しながら画面表示</a></li>
      <li><a href="#com_1_5">apgでパスワード自動生成</a></li>
      <li><a href="#com_1_6">nohupでログアウト後も処理を継続</a></li>
      <li><a href="#com_1_7">findでファイル処理</a></li>
      <li><a href="#com_1_8">sedで文字列の置換</a></li>
      <li><a href="#com_1_9">trで大文字と小文字の置換</a></li>
      <li><a href="#com_1_10">パス名からファイル名を取得</a></li>      
      <li><a href="#com_1_11">コマンドマニュアルの表示</a></li>   
  </ul>
  </li></ul>
</div>

<small><a href="#top">[top]</a></small> <br />
<br />
<hr width="105%" />
<br />


<!-- ここから本文 -->
<!-- スケジュール管理 -->
<h3><div class="headline1" id="linux_1">スケジュール管理</div></h3>
<h4><div class="headline2" id="linux_1_1">crontabに登録する</div></h4>
	<div class="text1">
		ログインしているアカウントのcronに登録する場合
		<pre>% crontab -e</pre>
		編集画面が現れるので、次のように設定する。
		<pre>分 時 日 月 週の何日目&nbsp; コマンド名</pre>
		<ul class="list1">
			<li>毎日8時45分にget.shスクリプトを動かす
				<pre>45 08 * * *  get.sh &gt; /dev/null 2 &gt;&amp; 1</pre>
				＊/dev/nullに渡して通知されないようにする
				＊2は標準エラー出力を表し、標準出力の1と一緒に出力するので両方が破棄される
			</li><br />
			<li>毎月1日にget.shスクリプトを動かす
				<pre>45 08 1 * *  get.sh &gt; /dev/null 2 &gt;&amp; 1</pre>
			</li>
			<li>毎週日曜にget.shスクリプトを動かす
				<pre>45 08 * * 0  get.sh &gt; /dev/null 2 &gt;&amp; 1</pre>
				0が日曜、1が月曜、2が火曜、3が水曜、4が木曜、5が金曜、6が土曜
			</li><br />
			<li>10分毎にスクリプトを動かす
				<pre>00,10,20,30,40,50  * * * *  get.sh &gt; /dev/null 2 &gt;&amp; 1</pre>
				または
				<pre>*/10  * * * *  get.sh &gt; /dev/null 2 &gt;&amp; 1</pre>
			</li>
		</ul>
	</div>

<h4><div class="headline2" id="linux_1_2">ユーザを指定してcrontabに登録する</div></h4>
	<div class="text1">
		/etc/crontabを編集する
		<pre>分 時 日 月 週の何日目&nbsp; ユーザ名&nbsp; コマンド名</pre>
		毎日50分に、clamupdateユーザ権限でウイルスデータベースを自動更新しログ保存
		<pre>50  * * * *  clamupdate /usr/bin/freshclam --quiet -l /var/log/clam-update.log</pre>
	</div>

<h4><div class="headline2" id="linux_1_3">crontabで月末に実行する</div></h4>
	<div class="text1">
		/etc/crontabを編集する
		<pre>分 時 日 月 週の何日目&nbsp; ユーザ名&nbsp; コマンド名</pre>
		dateコマンドを使い、次の日が1日だった場合に実行する。
		<pre>55　23　28-31 * * /usr/bin/test $( date -d '+1 day' +%d ) -eq 1 &amp;&amp; 実行したいコマンド</pre>
		＊「+%d」は月の中の何日目かを表す値（01-31）<br />
		<a href="https://www.server-memo.net/tips/command/date/date.html">dateコマンドで日付や時刻を表示したり設定する方法 </a>
	</div>


<!-- デバッグ関連 -->
<h3><div class="headline1" id="linux_2">デバッグ関連</div></h3>
<h4><div class="headline2" id="linux_2_1">プロセス毎の詳細なメモリ使用量を調べる</div></h4>
	<div class="text1">
		ps -efでプロセスIDを調べ、pmapコマンドを用いる
		<pre>% pmap -x プロセスID</pre>
	</div>

<h4><div class="headline2" id="linux_2_2">実行時に確保するメモリ領域毎のサイズを表示</div></h4>
	<div class="text1">
		ps -efで実行中のプロセスとして表示されるプロセスのバイナリへのパスを調べておく。
		<pre>% size 調べたいプロセスのバイナリへのパス</pre>
	</div>

<h4><div class="headline2" id="linux_2_3">実行時にリンクされるライブラリを調べる</div></h4>
	<div class="text1">
		lddを使うと実行時にリンクされるライブラリ（動的ライブラリ）を表示できる。
		<pre>% ldd 調べたいバイナリへのパス</pre>
	</div>


<!-- emacs関連 -->
<h3><div class="headline1" id="emacs_1">emacs関連</div></h3>
<h4><div class="headline2" id="emacs_1_1">emacsでカーソル位置を保存する</div></h4>
	<div class="text1">
		emacsの設定ファイル（.emacs）に追記する
		<ul class="list1">
			<li>24.5まで
				<pre>
				(require 'saveplace)
				(setq-default save-place t)
				</pre></li>
			<li>25.0以降
				<pre>
				(require 'saveplace)
				(save-place-mode 1) 
				</pre></li>
		</ul>
	</div>

<h4><div class="headline2" id="emacs_1_2">emacsで長い行を折り返す</div></h4>
	<div class="text1">
		長い行を折り返して表示
		<pre>Function : toggle-truncate-lines</pre><br />
		長い行を折り返す（改行が入る）
		<pre>Function : auto-fill-mode</pre>
	</div>

<h4><div class="headline2" id="emacs_1_3">emacsで矩形選択</div></h4>
	<div class="text1">
		矩形選択モードに切り替える
		<pre>Function : rectangle-mark-mode</pre><br />
		ショートカット
		<pre>C-x SPC</pre>
	</div>

<h4><div class="headline2" id="emacs_1_4">emacsで末尾のエスケープを揃える</div></h4>
	<div class="text1">
		regionを指定してから以下
		<pre>Function : sh-backslash-region</pre>
	</div>


<!-- vi関連 -->
<h3><div class="headline1" id="vi_1">vi関連</div></h3>
<h4><div class="headline2" id="vi_1_1">viの基本的な操作</div></h4>
	<div class="text1">
		起動する場合、端末を開き
		<pre>% vi</pre>
		コマンド入力モードの基本的な操作一覧
		<ul class="list1">
			<li>viの終了
				<pre>
				:q &nbsp; 保存しないで終了
				:q! &nbsp; 強制終了
				ZZ &nbsp; 保存して終了
				</pre>
				（挿入モードになっている場合、ESCでコマンド入力モードに切り替える）</li><br />
			<li>カーソルの移動（隣接する場所）
				<pre>
				h, j, k, l &nbsp; 左、下、上、右
				</pre>
				＊隣接するhjklキーに人差指から小指までを置いて操作
			</li><br />
			<li>カーソルの移動（離れた場所）
				<pre>
				0 &nbsp; 行頭に移動
				$ &nbsp; 行末に移動
				[[ &nbsp; 文頭に移動
				]] &nbsp; 文末に移動
				50G &nbsp; 50行目に移動
				:50 &nbsp; 50行目に移動
				10| &nbsp; 現在の行の10文字目に移動
				E &nbsp; 単語の末尾に移動
				B &nbsp; 単語の先頭に移動
				fT &nbsp; 現在の行のカーソルより後ろにある文字Tに移動
				FT &nbsp; 現在の行のカーソルより前にある文字Tに移動
				</pre>
			</li>
			<li>挿入
				<pre>
				i &nbsp; カーソルのある位置に挿入
				I &nbsp; 文頭に挿入（カーソルが行の途中にある場合に便利）
				a &nbsp; カーソルの後ろに挿入（行末にカーソルがあり、後ろに追加する場合に必要）
				A &nbsp; 文末に挿入（カーソルが行の途中にある場合に便利）
				o &nbsp; カーソルの下に新しい行を挿入し、その行を編集
				</pre>
			</li>
			<li>やり直し（アンドゥ）
				<pre>
				u &nbsp; 直前の動作を取り消
				</pre>
			</li>
			<li>削除
				<pre>
				x &nbsp; 1文字削除
				3x &nbsp; 3文字削除
				dd &nbsp; 1行削除（d1dの省略型） 
				d5d &nbsp; 5行削除
				dw &nbsp; 1単語削除（d1wの省略型）
				d$ &nbsp; 行末まで削除
				d]] &nbsp; 文末まで削除
				:10,20d &nbsp; 10から20行目までを削除
				</pre>
			</li>
			<li>コピー
				<pre>
				yy &nbsp; 1行コピー（y1yの省略型）
				y3y &nbsp; 3行コピー
				yw &nbsp; 1単語コピー（y1wの省略型）
				y$ &nbsp; 行末までコピー
				y]] &nbsp; 文末までコピー
				:10,20y &nbsp; 10から20行目までをコピー
				</pre>
			</li>
			<li>貼り付け
				<pre>
				p &nbsp; 直前のコピー、削除でバッファに入った内容を貼り付け
				</pre>
			</li>
			<li>行の連結
				<pre>
				J &nbsp; 現在カーソルがある行に次の行を連結する
				</pre>
				＊一度改行したら、この方法でしか戻せない
			</li><br />
			<li>検索
				<pre>
				:/word &nbsp; 文字列wordを順方向に検索
				:?word &nbsp; 文字列wordを逆方向に検索
				</pre>
			</li>
			<li>置換
				<pre>
				r &nbsp; カーソルの文字をrの次にタイプする文字に置き換え（挿入モードに移ることなく文章を編集できる）
				:%s/word1/word2/g &nbsp; 文章中のword1を全てword2に
				:%s/word1/word2/ &nbsp; 行の先頭にあるword1をword2に
				:%s/word1/word2/c &nbsp; 置換の前に確認する場合
				:10,50s/word1/word2/g &nbsp; 10から50行目のword1を全てword2に
				</pre>
			</li>
			<li>ファイル操作
				<pre>
				:10,30w newfile &nbsp; 10-30行目をnewfileに書き込み
				:.,$w &lt;&lt; file &nbsp; 現在の行から文末までをfileに追加書き込み
				</pre>
			</li>
		</ul>
	</div>

<h4><div class="headline2" id="vi_1_2">viの設定変更</div></h4>
	<div class="text1">
		コマンド入力モードで操作する。ホームディレクトリの.exrcに記載すると、毎回反映される。
		<ul class="list1">
			<li>括弧の対応を表示する
				<pre>set showmatch</pre>
			</li>
			<li>大文字／小文字を区別しない
				<pre>set ignorecase</pre>
			</li>
			<li>自動インデント機能を有効にする
				<pre>set autoindent</pre>
			</li>
			<li>カーソルがある行・列を表示する
				<pre>set ruler</pre>
			</li>
			<li>挿入モードの時に画面の下に表示が出るようにする
				<pre>set showmode</pre>
			</li>
			<li>ソースコードの文法を解釈して表示する
				<pre>syntax on</pre>
			</li>
			<li>バックアップファイルを作らない
				<pre>set nobackup</pre>
			</li>
		</ul>
	</div>


<!-- awk関連 -->
<h3><div class="headline1" id="awk_1">awk関連</div></h3>
<h4><div class="headline2" id="awk_1_1">列を取り出す</div></h4>
	<div class="text1">
		printを使う
		<ul class="list1">
			<li>ファイルから1列目、2列目を取り出す
				<pre>awk '{print $1, $2}' ファイル名</pre>
			</li>
			<li>1列目が10の場合のみを取り出す
				<pre>awk '($1==10){print $1, $2}' ファイル名</pre>
				等しい: ==、等しくない: !=<br />
				より大きい: &gt;、以上: &gt;=、より小さい: &lt;、以下: &lt;=
			</li><br />
			<li>1列目が10、2列目が5以上の場合のみを取り出す
				<pre>awk '($1==10 &amp;&amp; $2 &gt;= 5){print $1, $2}' ファイル名</pre>
			</li>
			<li>1列目が0以下か、1列目が10以上の場合のみを取り出す
				<pre>awk '($1 &lt;=0 || $1 &gt;= 10){print $1, $2}' ファイル名</pre>
				かつ(AND): &amp;&amp;、または(OR): || 
			</li><br />
		</ul>
	</div>

<h4><div class="headline2" id="awk_1_2">演算を行う</div></h4>
	<div class="text1">
		入力した値を100倍する
		<pre>echo 15 | awk '{print $1*100}'
		出力：1500
		</pre>
		tan(1)を求める
		<pre> awk 'BEGIN {print sin(1) / cos(1)}'
		出力：1.55741
		</pre>
		指数関数（eを出力）
		<pre> awk 'BEGIN {print exp(1)}'
		出力：2.71828
		</pre>
		ファイル１列目の積算値を求める
		<pre>awk 'BEGIN{}{sum=sum+$1}END{print sum}' ファイル名</pre>
		ファイル１列目の平均値を求める
		<pre>awk 'BEGIN{}{n++ ; sum=sum+$1}END{print sum/n}' ファイル名
		</pre>
	</div>

<h4><div class="headline2" id="awk_1_3">書式を指定する</div></h4>
	<div class="text1">
		printfを用いる
		<ul class="list1">
			<li>整数を出力する（小数点以下切り捨て）
				<pre>echo 5.5 | awk '{printf &quot;%d¥n&quot;, $1}<br />出力：<br />5</pre>
			</li>
			<li>符号を付けて整数を出力する
				<pre>echo 5 | awk '{printf &quot;%+d¥n&quot;, $1}'<br />出力：<br />+5<br />echo -5 | awk '{printf &quot;%+d¥n&quot;, $1}'<br />出力：<br />-5<br /></pre>
			</li>
			<li>6桁の整数を出力する（右詰めで左側に空白）
				<pre>echo 5 | awk '{printf &quot;%6d¥n&quot;, $1}'<br />出力：<br />&nbsp; &nbsp; 5</pre>
			</li>
			<li>6桁の整数を出力する（右詰めで0埋め）
				<pre>echo 5 | awk '{printf &quot;%06d¥n&quot;, $1}'<br />出力：<br />000005</pre>
			</li><br />
			<li>小数点第２位まで出力する
				<pre>echo 5.3 | awk '{printf &quot;%.2f¥n&quot;, $1}'<br />出力：<br />5.30</pre>
			</li>
			<li>符号を付けて出力する
				<pre>echo 5.3 | awk '{printf &quot;%+.2f¥n&quot;, $1}'<br />出力：<br />+5.30<br />echo -5.3 | awk '{printf &quot;%+.2f¥n&quot;, $1}'<br />出力：<br />-5.30</pre>
			</li>
			<li>小数点以下3桁、9文字分で表示する（右詰めで左側に空白）
				<pre>echo 5.3 | awk '{printf &quot;%9.3f¥n&quot;, $1}'<br />出力：<br />&nbsp; &nbsp; 5.300</pre>
			</li>
			<li>左詰めにする場合
				<pre>echo 5.3 | awk '{printf &quot;%-9.3f¥n&quot;, $1}'<br />出力：<br />5.300 &nbsp; &nbsp;</pre>
			</li><br />
		</ul>
	</div>

<h4><div class="headline2" id="awk_1_4">区切り文字を指定する</div></h4>
	<div class="text1">
		デフォルトの区切り文字は空白かタブだが、オプション-Fを用いると変更可能
		<ul class="list1">
			<li>区切り文字をカンマ（,）とする
				<pre>awk -F ',' '{print $1, $2}' ファイル名</pre>
			</li>
			<li>区切り文字をハイフン（-）とする
				<pre>awk -F '-' '{print $1, $2}' ファイル名</pre>
			</li>
		</ul>
	</div>



<!-- ネットワーク関連 -->
<h3><div class="headline1" id="network_1">ネットワーク関連</div></h3>
<h4><div class="headline2" id="network_1_1">IPアドレスを確認する</div></h4>
	<div class="text1">
	<ul class="list1">
		<li>ipコマンド（Linux）
			<pre>% ip addr（または% ip a）</pre>
			＊標準的に入っている<br />
			他の使い方は<a href="https://atmarkit.itmedia.co.jp/ait/articles/1709/22/news019.html">【 ip 】コマンド</a>参照
		</li><br />
		<li>ifconfigコマンド（Linux/macOS）
			<pre>% ifconfig</pre>
			＊Linuxでは、net-toolsパッケージに入っている
		</li><br />
	</ul>
	</div>

<h4><div class="headline2" id="network_1_2">ネットワークデバイスを表示する</div></h4>
	<div class="text1">
		<pre>% ip link</pre>
		＊Linuxの場合
	</div>

<h4><div class="headline2" id="network_1_3">ルーティングテーブルの内容を表示する</div></h4>
	<div class="text1">
		<ul class="list1">
			<li>ipコマンド（Linux）
				<pre>% ip route（または% ip r）</pre>
				＊IPv6のテーブルを表示したい場合はip -6 route
			</li><br />
			<li>routeコマンド（Linux）
				<pre>% route</pre>
				＊IPv6のテーブルを表示したい場合はroute -6
			</li><br />
			<li>netstatコマンド（Linux/macOS）
				<pre>% netstat -rn</pre>
				＊Linuxでは非推奨でip routeを使う<br />
			</li><br />
			<li>メインテーブルを表示
				<pre>% ip route show table main</pre>
			</li>
			<li>ローカルテーブルを表示
				<pre>% ip route show table local</pre>
			</li>
		</ul>
	</div>

<h4><div class="headline2" id="network_1_4">通信の状態を調べる</div></h4>
	<div class="text1">
		<ul class="list1">
			<li>到達確認（Linux/macOS/Windows）
				<pre>% ping IPアドレス</pre>
				＊双方向にパケットが到達することを確認<br />
				＊デフォルトゲートウェイ、DNSサーバ等のIPアドレスを入力し到達確認<br />
				＊IPアドレスの代わりにDNSアドレスも利用可能だが、DNSサーバが正常に応答している時のみ使用したほうが良い<br />
				＊ファイアウォールや相手側の設定で、pingに応答しないようにしていることがある
			</li><br />
			<li>DNSサーバの応答確認（Linux/macOS）
				<pre>% nslookup IPアドレスまたはDNSアドレス</pre>
				＊IPアドレスからDNSアドレス、DNSアドレスからIPアドレスが返ってくることを確認<br />
			</li><br />
		</ul>
	</div>

<h4><div class="headline2" id="network_1_5">LISTENポートをチェックする</div></h4>
	<div class="text1">
		TCPのLISTENポートをチェックする
		<pre>% ss -napt</pre>
		UDPのLISTENポートをチェックする
		<pre>% ss -napu</pre>
		他の使い方は<a href="https://atmarkit.itmedia.co.jp/ait/articles/1710/06/news014.html">【 ss 】コマンド</a>参照
	</div>

<h4><div class="headline2" id="network_1_6">ARPテーブルを表示する</div></h4>
	<div class="text1">
		ARP（Address Resolution Protocol）テーブルにある現在のエントリを一覧表示
		<pre>% ip neigh</pre>
	</div>


<!-- ユーザ管理 -->
<h3><div class="headline1" id="user_1">ユーザ管理</div></h3>
<h4><div class="headline2" id="user_1_1">ユーザを追加する</div></h4>
	<div class="text1">
		<pre># adduser ユーザ名</pre>
		ユーザID（UID）を指定する場合<br />
		＊初期パスワードの設定やホームディレクトリ作成を同時に行う
		<pre># adduser ユーザ名 --uid UID</pre>
		ユーザ作成と同時にwheelグループに追加する場合
		<pre># adduser -G wheel ユーザ名 </pre>
		ユーザ作成と同時にsudoグループに追加する場合（Ubuntu）
		<pre># adduser -G sudo ユーザ名 </pre>
	</div>

<h4><div class="headline2" id="user_1_2">ユーザを削除する</div></h4>
	<div class="text1">
		<pre># userdel ユーザ名</pre>
	</div>

<h4><div class="headline2" id="user_1_3">グループを追加する</div></h4>
	<div class="text1">
		<pre># groupadd グループ名</pre>
		グループID（GID）を指定する場合
		<pre># groupadd グループ名 -g GID</pre>
	</div>

<h4><div class="headline2" id="user_1_4">ユーザをグループに追加する</div></h4>
	<div class="text1">
		<pre># gpasswd -a ユーザ名 グループ名</pre>
	</div>

<h4><div class="headline2" id="user_1_5">ユーザをグループから削除する</div></h4>
	<div class="text1">
		<pre># gpasswd -d ユーザ名 グループ名</pre>
	</div>

<h4><div class="headline2" id="user_1_6">ユーザの所属するグループを変更する</div></h4>
	<div class="text1">
		usermodを使い、含めたいグループを並べる
		<pre># usermod -G グループ1,グループ2, グループ3 ユーザ名</pre>
	</div>


<!-- システム管理 -->
<h3><div class="headline1" id="system_1">システム管理</div></h3>
<h4><div class="headline2" id="system_1_1">ディスク使用量</div></h4>
	<div class="text1">
		dfコマンドを使う
		<pre>% df -k</pre>
	</div>

<h4><div class="headline2" id="system_1_2">温度監視</div></h4>
	<div class="text1">
		sensorsコマンドをインストールする
		<ul class="list1">
			<li>RedHat系
				<pre># dnf -y install lm_sensores</pre></li>
			<li>Ubuntu
				<pre># apt install lm_sensores</pre></li>
		</ul>
		確認
		<pre>% sensors</pre>
	</div>

<h4><div class="headline2" id="system_1_3">ログ通知</div></h4>
	<div class="text1">
		<ul class="list1">
			<li>Logwatchをインストールする
				<ul class="list2">
					<li>RedHat系8以降
						<pre># dnf -y install logwatch</pre>
					</li>
					<li>Ubuntu
						<pre># apt install logwatch</pre>
					</li>
					<li>OpenSUSE
						<pre># zypper -n install logwatch</pre>
						または
						<pre># yast</pre>
						パッケージでlogwatchを検索する
					</li><br />
				</ul>
			</li>
			<li>Logwatch用の一時ディレクトリの作成
				<pre># mkdir /var/cache/logwatch</pre>
			</li><br />
			<li>メールでの通知を行う設定<br />
				まずは、デフォルトのlogwatch.conf設定ファイルを /etc/logwatch/conf/logwatch.confにコピー<br />
				<pre># cp /usr/share/logwatch/default.conf/logwatch.conf /etc/logwatch/conf/</pre>
				コピーしたlogwatch.confを編集し、標準出力の代わりにメールを送信するように変更する
				<pre>
				# Output = stdout
				Output = mail
				</pre>
			</li><br />
			<li>外部メールへの転送も行う場合には、postfixをインストールしておく
				<ul class="list2">
					<li>RedHat系8以降
						<pre># dnf -y install postfix</pre>
					</li>
					<li>Ubuntu
						<pre># apt install postfix</pre>
					</li>
					<li>OpenSUSE
						<pre># zypper -n install postfix</pre>
						または
						<pre># yast</pre>
						パッケージでpostfixを検索する
					</li><br />
				</ul>
			</li>
			<li>ログメールを送信するホスト名の設定（必要な場合）<br />
				メール転送の際にDNSサーバに問い合わせを行っており、存在しないホスト名では送信が拒否されてしまう。その場合は、/etc/postfix/main.cfでmyhostnameを設定する
				<pre>myhostname = 存在するホスト名.所属するドメイン名</pre>
				IPアドレスのみでホスト名がない場合には、次のように設定すると回避できる
				<pre>myhostname = localhost</pre>
			</li><br />
			<li>通知先のメールアドレスを設定する（外部メールへの転送も行う場合）<br />
				/etc/aliasesに下記を追加
				<pre>root: メールアドレス</pre>
				＊rootに来たメールを指定したメールアドレスに転送する<br />
				<br />
				エイリアスの変更を反映する
				<pre># newaliases</pre>
			</li><br />
			<li>動作確認を行う
				<pre># logwatch</pre>
				指定したメールアドレスにlogwatchメールが届けば成功
			</li><br />
		</ul>
	</div>

<h4><div class="headline2" id="system_1_4">サービス一覧を表示する</div></h4>
	<div class="text1">
		systemctlコマンドを用いる
		<pre>% systemctl -t service</pre>
		＊/etc/systemd/system/か/usr/lib/systemd/system/を参照している<br />
		全サービスの一覧
		<pre>% systemctl list-unit-files -t service</pre>
	</div>

<h4><div class="headline2" id="system_1_5">サービスの管理</div></h4>
	<div class="text1">
		systemctlコマンドを次のように使用する
		<ul class="list1">
			<li>サービス起動
				<pre># systemctl start サービス名</pre>
			</li>
			<li>サービス停止
				<pre># systemctl stop サービス名</pre>
			</li>
			<li>サービス再起動
				<pre># systemctl restart サービス名</pre>
			</li>
			<li>サービスリロード
				<pre># systemctl reload サービス名</pre>
			</li>
			<li>サービスのステータス表示
				<pre>% systemctl status サービス名</pre>
			</li>
			<li>サービス自動起動有効
				<pre># systemctl enable サービス名</pre>
			</li>
			<li>サービス自動起動無効
				<pre># systemctl disable サービス名</pre>
			</li>
			<li>サービス起動と自動起動有効を同時に
				<pre># systemctl enable -now サービス名</pre>
			</li>
			<li>サービス自動起動設定確認
				<pre>% systemctl is-enabled サービス名</pre>
			</li>
			<li>設定ファイルの再読込
				<pre># systemctl daemon-reload サービス名</pre>
			</li>
		</ul>
	</div>

<h4><div class="headline2" id="system_1_6">サービスログの確認</div></h4>
	<div class="text1">
		journalctlコマンドを用いる（/var/log/journal/を参照している）
		<pre># journalctl -f -u サービス名</pre>
		＊/usr/lib/systemd/system/を参照している<br />
	</div>

<h4><div class="headline2" id="system_1_7">ランレベルの確認</div></h4>
	<div class="text1">
		systemctlコマンドを用いる（/usr/lib/systemd/system/*targetを参照している）
		<pre>% systemctl get-default</pre>
		＊multi-user.target: 従来のrunlevel 3（テキストログイン）
		＊graphical.target: 従来のrunlevel 5（グラフィカルログイン）
	</div>

<h4><div class="headline2" id="system_1_8">ランレベルの変更</div></h4>
	<div class="text1">
		systemctlコマンドを用いる
		<pre># systemctl set-default graphical.target</pre>
		＊グラフィカルログインに変更する（/etc/systemd/system/default.targetのシンボリックリンクを変更する）<br />
		<br />
		手動での変更方法
		<ul class="list1">
			<li>システム停止（従来のランレベル0）
				<pre># systemctl isolate poweroff.target</pre>
			</li>
			<li>シングルユーザーモード（従来のランレベル1）
				<pre># systemctl isolate rescue.target</pre>
			</li>
			<li>テキストログイン（従来のランレベル3）
				<pre># systemctl isolate rmulti-user.target</pre>
			</li>
			<li>グラフィカルログイン（従来のランレベル5）
				<pre># systemctl isolate graphical.target</pre>
			</li>
			<li>OSの再起動（従来のランレベル6）
				<pre># systemctl isolate reboot.target</pre>
			</li>
			<li>緊急モード
				<pre># systemctl isolate emergency.target</pre>
			</li>
		</ul>
	</div>

<h4><div class="headline2" id="system_1_9">ディスク管理</div></h4>
	<div class="text1">
		ディスクを準備する際
		<ol class="list1">
			<li> デバイス名の確認
				<pre>% ls -l /dev/disk/sd*<br />% df</pre>
				現在マウントされていない新しいデバイスを探す
			</li><br />
			<li> パーティションの作成
				<pre>% parted</pre>
				pでパーティションテーブルを表示する。qで終了<br />
				新しいパーティションテーブルを作成するには
				<pre>mklabel gpt<br />mkpart</pre>
			</li><br />
		</ol>
		ディスクをマウントする際は下記の手順
		<ol class="list1">
			<li> ディスクパーティションのUUID確認
				<pre>% blkid</pre>
				ディスクパーティション毎のUUIDが表示される
			</li><br />
			<li>/etc/fstabへの追加
				<pre>UUID="表示されたUUID" &nbsp; &nbsp; /mnt/data01 &nbsp; &nbsp; xfs &nbsp; &nbsp; defaults &nbsp; &nbsp; 1 &nbsp; 2</pre>
				＊/mnt/data01の部分はマウントポイント<br />
				＊xfsの部分にはフォーマットしたファイルシステムを記載
			</li><br />
		</ol>
	</div>

<h4><div class="headline2" id="system_1_10">ファイアウォール</div></h4>
<div class="text1">
	ubuntuの場合ufw、Red Hat系ではfirewall-cmd
	<ul class="list1">
		<li>ubuntuのufw
			<ul class="list2">
				<li>状態の確認
					<pre># systemctl status ufw</pre>
					＊「Active: active (exited)」 なら起動している
				</li><br />
				<li>状態の確認
					<pre># ufw status</pre>
					＊「状態: 非アクティブ」なら起動しているが非アクティブ<br />
					＊「状態: アクティブ」なら起動していてアクティブ
				</li><br />
				<li>アクティブな場合に、詳細な状態の確認
					<pre># ufw status verbose
					ロギング: on (low)
					Default: deny (incoming), allow (outgoing), disabled (routed)
					
					新しいプロファイル: skip
					
					To Action From
					-- ------ ----
					22/tcp ALLOW IN Anywhere
					22/tcp (v6) ALLOW IN Anywhere (v6)
					</pre>
					＊デフォルトで外からの接続を拒否し、内からの全ての接続を許可し、外からのssh接続のみ許可した場合
				</li><br />
			</ul>
		</li><br />
		<li>RedHatk系、OpenSuSEのfirewalld
			<ul class="list2">
				<li>状態の確認
					<pre># systemctl status firewalld.service</pre>
			    </li><br />
				<li>サービスの有効化
					<pre># systemctl enable firewalld.service</pre>
				</li>
				<li>サービスの無効化
					<pre># systemctl disable firewalld.service</pre>
				</li>
				<li>自動起動設定の状態確認
					<pre># systemctl is-enabled firewalld.service</pre>
				</li>
			</ul>
		</li>
	</ul>
</div>

<h4><div class="headline2" id="system_1_11">パッケージ管理</div></h4>
	<div class="text1">
		ubuntuの場合apt、Red Hat系ではdnf、OpenSuSEdではzypper
	</div>

<!-- OSアップデート -->
<h3><div class="headline1" id="os_1">OSアップデート</div></h3>
	<h4><div class="headline2" id="os_1_1">OpenSUSEのOSアップデート</div></h4>
	<div class="text1">
		OpenSUSEの安定版Leapは年に一度、マイナーバージョンのアップデートが行われる。自動では適用されない。リリースから1年半程度でマイナーバージョンのサポート期限が切れるので、その前にアップデートを行う。アップデートの前に必ずバックアップを作成する。バージョンを確認するため、下記をインストール。
		<pre>
		# zypper install lsb-release
		% lsb_release -d
		出力：Description:	openSUSE Leap 15.5</pre>
		パッケージの確認（repo-update 、repo-backports-update、repo-sle-update）
		<pre># zypper repos -u</pre>
Leap 15.5から15.6にアップデートする場合、下記のように15.6のパッケージに設定（既に使われている名前と重複しているとのエラーが出ることがあるが、ここでは無視して良い）。必ず次のマイナーバージョンにアップデートし、1つ飛ばしなどは行わない。
		<pre>
		# zypper addrepo --check --refresh --name 'repo-update' http://download.opensuse.org/update/leap/15.6/oss/ repo-update
		# zypper addrepo --check --refresh --name 'repo-backports-update' http://download.opensuse.org/update/leap/15.6/backports/ repo-backports-update
		# zypper addrepo --check --refresh --name 'repo-sle-update' http://download.opensuse.org/update/leap/15.6/sle/ repo-sle-update</pre>
		アップデートの前にパッケージを最新のものに更新しておく
		<pre>
		# zypper refresh
		# zypper update</pre>
		全てのリポジトリを強制的に15.6にする
		<pre># zypper --releasever=15.6 refresh</pre>
		最後にすべての有効なリポジトリを利用して、ディストリビューションのアップグレードを行う
		<pre># zypper --releasever=15.6 dup --download-in-advance</pre>
		パッケージ数やマシンの性能にもよるが、かなり時間がかかる。全てのアップグレードが終了したらシステムの再起動を行う
		<pre># shutdown -r now</pre>
		再起動後、バージョンを確認する
		<pre>
		% lsb_release -d
		出力：Description:	openSUSE Leap 15.6</pre>
	</div>


<!-- SSH関連 -->
<h3><div class="headline1" id="ssh_1">SSH関連</div></h3>
<h4><div class="headline2" id="ssh_1_1">ホスト公開鍵の更新</div></h4>
	<div class="text1">
		SSHホストが更新された際、ホスト公開鍵が以前のものと異なるため警告が出てログインできなくなる。
		<pre>% ssh-keygen -R ホスト名</pre>
		でリセット可能<br />
		$HOME/.ssh/known_hostsを編集して該当するホストの行を削除しても同じ
	</div>

<h4><div class="headline2" id="ssh_1_2">SSH秘密鍵と公開鍵の新規生成</div></h4>
	<div class="text1">
		<pre>% ssh-keygen</pre>
		＊デフォルトは暗号化形式rsa、ビット数は2048bit<br />
		詳細なオプションは<a href="https://atmarkit.itmedia.co.jp/ait/articles/1908/02/news015.html">コマンド――SSHの公開鍵と秘密鍵を作成する</a>参照<br />
		＊公開鍵は見せても良いが、秘密鍵は所有者のみが管理する<br /><br />
		楕円曲線を利用したアルゴリズムで鍵を作成する
		<pre>% ssh-keygen -t ed25519</pre>
	</div>

<h4><div class="headline2" id="ssh_1_3">ユーザー名を指定してログイン</div></h4>
	<div class="text1">
		<pre>% ssh hostname -l ユーザー名</pre>
	</div>

<h4><div class="headline2" id="ssh_1_4">秘密鍵を指定してログイン</div></h4>
	<div class="text1">
		<pre>% ssh hostname -i ~/.ssh/秘密鍵のファイル名 </pre>
		＊秘密鍵のパスフレーズを入力する
	</div>

<h4><div class="headline2" id="ssh_1_5">X11転送を有効にする</div></h4>
	<div class="text1">
		sshコマンドに-Xオプションを与える（ForwardX11有効）
		<pre>% ssh -X hostname</pre>
		＊接続先ホストのsshd設定（/etc/ssh/sshd_config等）でForwardX11が無効にされている場合は利用できない<br />
		emacsなど一部のアプリケーションはForwardX11Trustedも有効にしていないと動作しない。その場合には-Yオプションを付ける
		<pre>% ssh -Y hostname</pre>
	</div>

<h4><div class="headline2" id="ssh_1_6">configファイルを使う</div></h4>
	<div class="text1">
		&sim;/.ssh/configに記述する
		<pre>Host 接続先ホスト名の略称等<br />&nbsp; &nbsp; Hostname IPアドレスまたはドメイン名<br />&nbsp; &nbsp; user ログインユーザ名<br />&nbsp; &nbsp; IdentityFile<br />&sim;/.ssh/秘密鍵のファイル名</pre>
		次のコマンドで秘密鍵を指定したログインが可能
		<pre>% ssh 接続先ホスト名の略称等</pre>
	</div>

<h4><div class="headline2" id="ssh_1_7">カスケード接続</div></h4>
	<div class="text1">
		&sim;/.ssh/configに記述する
		<pre>Host 踏み台サーバの略称等<br />&nbsp; &nbsp; Hostname 踏み台サーバのIPアドレスまたはドメイン名<br />&nbsp; &nbsp; user 踏み台サーバのログインユーザ名<br />&nbsp; &nbsp; IdentityFile &sim;/.ssh/秘密鍵のファイル名</pre>
		<pre>Host 接続先ホスト名の略称等<br />&nbsp; &nbsp; Hostname IPアドレスまたはドメイン名<br />&nbsp; &nbsp; user ログインユーザ名<br />&nbsp; &nbsp; ProxyCommand ssh -W %h:%p 踏み台サーバの略称等<br />&nbsp; &nbsp; IdentityFile &sim;/.ssh/秘密鍵のファイル名</pre>
		次のコマンドで秘密鍵を指定したカスケード接続が可能（秘密鍵のパスフレーズを2回入力する）
		<pre>% ssh 接続先ホスト名の略称等</pre>
	</div>

<h4><div class="headline2" id="ssh_1_8">ポートフォワード</div></h4>
	<div class="text1">
		<ul class="list1">
			<li>sshコマンドに-Lオプションを付ける場合<br />
				例：ローカルの8001番をsshログイン先の8000番ポートに転送
				<pre>ssh 接続先 -L8001:localhost:8000 -f -N -C</pre>
				＊sshをバックグラウンドで実行（-f）、リモートでコマンドを実行しない（-N）、圧縮を有効（-C）</li><br />
			<li>&sim;/.ssh/configに記述する場合
				<pre>Host 接続先ホスト名の略称等<br />&nbsp; &nbsp; Hostname IPアドレスまたはドメイン名<br />&nbsp; &nbsp; user ログインユーザ名<br />&nbsp; &nbsp; IdentityFile ~/.ssh/秘密鍵のファイル名<br />&nbsp; &nbsp; LocalForward 8000 localhost:8001</pre>
				＊ローカルの8000番ポートをログイン先の8001番ポートに転送する<br />
				次のコマンドで秘密鍵を指定したポートフォワードが可能
				<pre>% ssh -f -N -C 接続先ホスト名の略称等</pre>
			</li><br />
			<li>別のホストに転送することも可能<br />
				例：ローカルの8001番をsshログイン先からアクセス可能なプライベートネットワークに転送
				<pre>ssh 接続先 -L8001:192.168.10.2:8000 -f -N -C</pre>
				＊プライベートネットワーク上にある192.168.10.2のポート8000番に転送する<br />
				＊sshログイン先からプライベートネットワーク上の192.168.10.2までは暗号化されないので注意</li><br />
		</ul>
	</div>

<h4><div class="headline2" id="ssh_1_9">sshdがLISTENするポートを指定する</div></h4>
	<div class="text1">
		/etc/ssh/sshd_configに記述する
		<pre>Port 22<br />Port 22222</pre>
		＊通常の22番ポートに加えて22222番ポートをLISTENする場合<br />
		設定を有効にする
		<pre>% systemctl reload sshd.service</pre>
		接続する場合
		<pre>% ssh -p 22222 接続先ホスト名の略称等</pre>
	</div>

<h4><div class="headline2" id="ssh_1_10">sshdでパスワード試行回数を制限する</div></h4>
	<div class="text1">
		PAM（Pluggable Authentication Modules）のpam_faillock モジュールを使用。<br />
		/etc/security/faillock.confを編集
		<pre>deny = 10 &nbsp;&nbsp; # 認証失敗を10回でロック<br />fail_interval = 900 &nbsp;&nbsp; # 失敗回数のカウント対象時間（秒）<br />unlock_time = 600 &nbsp;&nbsp;  # ロック解除までの時間（秒）</pre>
	</div>

<!-- bash関連 -->
 <h3><div class="headline1" id="bash_1">bash関連</div></h3>
<h4><div class="headline2" id="bash_1_1">配列の作成</div></h4>
	<div class="text1">
		<pre>配列名=(値1 値2 値3)</pre>
		例：配列を作成し中身を表示する
		<pre>% array=(var1 var2 var3)<br />% echo ${array[@]}<br />var1 var2 var3<br />% echo ${array}<br />var1<br />% echo ${array[0]}<br />var1<br />% echo ${array[1]}<br />var2</pre>
</div>

<h4><div class="headline2" id="bash_1_2">配列の値の変更、配列への追加</div></h4>
	<div class="text1">
		作成した配列の要素を置き換える場合
		<pre>% array=(var1 var2 var3)<br />% array[2]=hoge<br />% echo ${array[@]}<br />var1 var2 hoge</pre>
		要素を追加する場合
		<pre>% array=(var1 var2 var3)<br />% array[3]=var4<br />% echo ${array[@]}<br />var1 var2 var3 var4</pre>
		＊要素数が3の時にarray[4]に追加した場合、array[3]に追加される
	</div>

<h4><div class="headline2" id="bash_1_3">配列の要素数を表示する</div></h4>
	<div class="text1">
		次のように配列の要素数を表示できる。
		<pre>
		% array=(var1 var2 var3)<br />% echo ${#array[@]}</pre>
	</div>

<h4><div class="headline2" id="bash_1_4">配列の要素を順に利用する</div></h4>
	<div class="text1">
		次のようにforループを使い、要素を順に利用する（スクリプトに記載）。
		<pre>#!/bin/bash<br />array=(var1 var2 var3)<br />for arr in ${array[@]}<br />do<br />&nbsp; echo ${arr}<br />done</pre>
		要素数が同じ複数配列の場合は、whileループを使う。
		<pre>#!/bin/bash<br />array1=(var11 var12 var13)<br />array2=(var21 var22 var23)<br />n=0<br />while test n -lt ${#array1[@]}<br />do<br />&nbsp; arr1=array1[$n]<br />&nbsp; arr2=array2[$n]<br />&nbsp; echo ${arr1} ${arr2}<br />&nbsp; n=`expr ${n} + 1`<br />done</pre>
	</div>

<h4><div class="headline2" id="bash_1_5">コマンドの結果を配列に入力する</div></h4>
	<div class="text1">
		次のようにバックスラッシュで囲む。
		<pre>
		% array=`command options`
		</pre>
		次のように記述することも可能。
		<pre>
		% array=$(command options)
		</pre>
		パイプでつなげた結果を使うことも可能。
		<pre>
		% array=$(command1 options| command2 options)
		</pre>
		標準エラー出力も標準出力に。
		<pre>
		% array=$(command1 options| command2 options 2&gt;&amp;1)
		</pre>
	</div>

<h4><div class="headline2" id="bash_1_6">リダイレクト</div></h4>
	<div class="text1">
		コマンドへの入力やコマンドの出力等を扱う時に利用する。
		<ul class="list1">
			<li>例：lsコマンドの出力をファイルに書き出す
				<pre>% ls &gt; file </pre>
			</li>
			<li>例：複数ディレクトリに対するlsコマンドの出力をファイルに書き出す
				<pre>% ls ディレクトリ1 &gt; file <br />% ls ディレクトリ2 &gt;&gt; file </pre>
			</li>
			<li>例：コマンドの標準出力／標準エラー出力を同一ファイルに書き出す（その１）
				<pre>% コマンド &amp;&gt; file </pre>
			</li>
			<li>例：コマンドの標準出力／標準エラー出力を同一ファイルに書き出す（その２）
				<pre>% コマンド &gt; file 2&gt;&amp;1</pre>
			</li>
			<li>例：コマンドの標準出力／標準エラー出力を捨てる
				<pre>% コマンド &gt;&amp; /dev/null<br />% コマンド &amp;&gt; /dev/null<br />% コマンド &gt; /dev/null 2&gt;&amp;1<br />% コマンド 1&gt; /dev/null 2&gt; /dev/null</pre>
				全て同じなので、使いやすいものを使う</li><br />
			<li>例：コマンドへの入力
				<pre>% コマンド &lt; オプションなど</pre>
			</li>
			<li>例：指定範囲までをcatコマンドに入力する
				<pre>% cat &lt;&lt;EOFline1<br />line2<br />EOF</pre></li>
			<li>例：指定範囲までをファイルに入力する
				<pre>% cat &gt; test.txt&lt;&lt;EOF<br />line1<br />line2<br />EOF</pre>
				test.txtに内容が入る
			</li><br />
		</ul>
	</div>

<h4><div class="headline2" id="bash_1_7">数字の桁</div></h4>
	<div class="text1">
		整数を5文字になるまで0埋めする
		<pre>n=3<br />nn=$(printf &quot;%05d&quot; ${n})3<br />出力：000033</pre>小数点以下１位まで表示する
		<pre>n=3<br />nn=$(printf &quot;%5.1f&quot; ${n})<br />出力：3.0</pre>
	</div>


<!-- ファイル関連 -->
<h3><div class="headline1" id="file_1">ファイル/ディレクトリ関連</div></h3>
<h4><div class="headline2" id="file_1_1">空のファイル作成、タイムスタンプ更新</div></h4>
	<div class="text1">
		test01という名前のファイルを作成する。既に存在する場合には、タイムスタンプを更新する
		<pre>% touch test01</pre>
		存在しているファイルの中身を消して、同じ名前のファイルを生成する場合、
		<pre>% cp /dev/null test01</pre>
	</div>

<h4><div class="headline2" id="file_1_2">ディレクトリ作成</div></h4>
	<div class="text1">
		mkdirコマンドを用いる
		<pre>% mkdir dir01</pre>
		既存のディレクトリをコピーする
		<pre>% cp -r dirpath newdir</pre>
	</div>

<h4><div class="headline2" id="file_1_3">ファイル/ディレクトリのパーミッション</div></h4>
	<div class="text1">
		パーミッションを変更する
		<pre>% chmod 755 dir01</pre>
		全員にディレクトリを読み込み可能とする（所有者は書き込みも可能）
		<pre>% chmod 644 file01</pre>
		全員にファイルを読み込み可能とする（所有者は書き込みも可能）
	</div>

<h4><div class="headline2" id="file_1_4">setuidとsetgid</div></h4>
	<div class="text1">
		setuidを設定すると、ファイルの所有者に基づいたアクセス権が、setgidを設定するとユーザーにはそのグループに与えられたアクセス権に基づくアクセス権が与えられる。
	</div>

<h4><div class="headline2" id="file_1_5">ACLの設定</div></h4>
	<div class="text1">
		ACLの情報を取得する
		<pre>% getfacl パス</pre>
	</div>

<h4><div class="headline2" id="file_1_6">ファイルの分割と分割ファイルの結合</div></h4>
	<div class="text1">
		splitコマンドを使うと分割可能
		<pre>% tar zcf - --files-from=ファイル名 | split --verbose --bytes=1G - "split-"</pre>
		指定したファイルをtarで圧縮（gzip）した後、1GiBに分割（split-??のファイル名）<br />
		復元する場合は、catコマンドで単純に結合する（分割時に改行などは入らない）
		<pre>% cat split-* | tar zxvf -</pre>
		分割前に圧縮していたので、tarで展開している
	</div>


<!-- 画像関連 -->
<h3><div class="headline1" id="fig_1">画像関連</div></h3>
<h4><div class="headline2" id="fig_1_1">convertによるファイル形式変換</div></h4>
	<div class="text1">
		convertコマンドを用いると、別の画像ファイルの形式に変換できる
		<pre>% convert test01.eps test01.pdf</pre>
		＊epsファイルをpdfファイルに変換する場合<br />
	</div>

<h4><div class="headline2" id="fig_1_2">convertによるファイルサイズ変更</div></h4>
	<div class="text1">
		convertコマンドで拡大・縮小が可能
		<pre>% convert -resize 50% test01.jpg test01.jpg</pre>
		別の方法として、ピクセルサイズでの指定
		<pre>% convert -resize 1024x768 test01.jpg  test02.jpg</pre>
		1024x768のサイズに変換する
	</div>


<!-- その他コマンド -->
<h3><div class="headline1" id="com_1">その他コマンド</div></h3>
<h4><div class="headline2" id="com_1_1">grepで該当行の前後２行を表示する</div></h4>
	<div class="text1">
		<pre>% grep -A 2 -B 2 検索文字列</pre>
	</div>

<h4><div class="headline2" id="com_1_2">diffを+-記号表示にする</div></h4>
	<div class="text1">
		<pre>% diff -U1 ファイル名1 ファイル名2</pre>
	</div>

<h4><div class="headline2" id="com_1_3">nkfでUTF-8とLF形式にする</div></h4>
	<div class="text1">
		nkf（Network Kanji Filter）では文字コードの変換や改行コードの変換を行うことができる。次のように文字コードをUTF-8、改行コードをLF（¥n）に変換し、元のファイルを上書きする
		<pre>% nkf -w -Lu --overwrite ファイル名</pre>
	</div>

<h4><div class="headline2" id="com_1_4">teeでmakeログを作成しながら画面表示</div></h4>
	<div class="text1">
		teeコマンドでは、パイプで渡された内容をファイルに書き出しながら画面にも表示することができる。makeの際にログファイルを残しながら表示するのに便利
		<pre>% make | tee ファイル名</pre>
	</div>

<h4><div class="headline2" id="com_1_5">apgでパスワード自動生成</div></h4>
	<div class="text1">
		apg（Automated Password Generator）コマンドでは、複雑なパスワードを自動生成することができる
		<pre>% apg</pre>
		デフォルトでは6種類の候補を表示する（-a0オプションがデフォルトで、発音できそうなものが選ばれる）。<br />
		<pre>% apg -a1</pre>
		ランダムなパスワードを表示する。
	</div>

<h4><div class="headline2" id="com_1_6">nohupでログアウト後も処理を継続</div></h4>
	<div class="text1">
		nohupコマンドを使うと、ログアウト後も処理を継続できる。次のようにバックグランドでコマンドを実行する。プロセスが終了するかkillされるか、システムがシャットダウンされるまで継続する
		<pre>% nohup コマンド &amp;</pre>
	</div>

<h4><div class="headline2" id="com_1_7">findでファイル処理</div></h4>
	<div class="text1">
		findコマンドでは、条件に一致するファイル/ディレクトリの検索やそれらに対しコマンドを実行することなどが可能で、応用できる範囲は広い
		<ul class="list1">
			<li>テキストファイル（*.txt）を検索する
				<pre>% find . -name '*.txt' </pre>
			</li>
			<li>検索したファイルに読み込み許可を与える
				<pre>% find . -name '*.txt' -exec chmod +r {} ¥;</pre>
			</li>
			<li>指定ディレクトリ以下のディレクトリのパーミッションを755にする（所有者以外に読み込みと実行を許可）
				<pre>% find ディレクトリのパス -type d -exec chmod 755 {} ¥;</pre>
			</li>
			<li>指定ディレクトリ以下のファイルに読み込み許可を与える
				<pre>% find ディレクトリのパス -type f -exec chmod +r {} ¥;</pre>
			</li>
			<li>1時間以内に変更されたファイルを表示する
				<pre>% find ディレクトリのパス -mtime -1h</pre>
				＊1週間なら1w、1日なら1d、30分なら30m、10秒なら10sとなる
			</li><br />
			<li>1日以内にアクセスされたファイルを表示する
				<pre>% find ディレクトリのパス -atime -1d</pre>
			</li><br />
			<li>7日間更新されなかったファイルを表示する
				<pre>% find ディレクトリのパス -mtime +7d</pre>
			</li>
			<li>ユーザ1の7日間更新されなかったファイルを表示する
				<pre>% find ディレクトリのパス ¥( -user ユーザ1 -mtime +7d ¥)</pre>
			</li>
			<li>30日更新されなかったファイルを削除する
				<pre>% find ディレクトリのパス -mtime +30d -exec rm {} ¥;</pre>
			</li>
			<br />
		</ul>
	</div>

<h4><div class="headline2" id="com_1_8">sedで文字列の置換</div></h4>
	<div class="text1">
		コマンドの出力やファイルなどの文字列をsedコマンドで置換できる
		<ul class="list1">
			<li>ファイルの文字列を置換する（行の先頭のみ）
				<pre>% cat ファイル名 | sed -e 's/元の文字列/置換する文字列/' </pre>
			</li><br />
			<li>ファイルの文字列をすべて置換する
				<pre>% cat ファイル名 | sed -e 's/元の文字列/置換する文字列/g' </pre>
			</li><br />
			<li>行番号を1から10行と指定してファイルの文字列を置換する
				<pre>% cat ファイル名 | sed -e '1,10s/元の文字列/置換する文字列/' </pre>
			</li>
			<li>行番号5から10行目のみを取り出す
				<pre>% cat ファイル名 | sed -n 5,10p</pre>
				＊-nオプションで全体の出力を抑制して、pオプションで指定行のみ出力する
			</li><br />
			<li>行番号2行目と5から10行目を取り出す
				<pre>% cat ファイル名 | sed -n -e 2p -e 5,10p</pre>
				＊-eオプションを使い、複数のスクリプトコマンドを指定する
			</li><br />
		</ul>
	</div>

<h4><div class="headline2" id="com_1_9">trで大文字と小文字の置換</div></h4>
	<div class="text1">
		trコマンドを使うと、簡単に小文字を大文字に変換できる
		<pre>% echo "文字列" | tr \[a-z\] \[A-Z\]</pre>
		大文字を小文字に変換することも可能
		<pre>% echo "文字列" | tr \[A-Z\] \[a-z\]</pre>
	</div>

<h4><div class="headline2" id="com_1_10">パス名からファイル名を取得</div></h4>
	<div class="text1">
		basenameコマンドを使うことで、パス名からファイル名を取得できる
		<pre>% basename パス名</pre>
		他のコマンドで取得したパス名を使うこともできる
		<pre>% basename `pwd`</pre>
		＊現在の絶対パスからディレクトリ名を取得
	</div>

<h4><div class="headline2" id="com_1_11">コマンドマニュアルの表示</div></h4>
	<div class="text1">
		マニュアルがインストールされていれば、manコマンドで表示できる
		<pre>% man コマンド名</pre>
		コマンド自身にマニュアル表示のオプションが入っている場合
		<pre>% コマンド名 --help</pre>
		または
		<pre>% コマンド名 -h</pre>
	</div>

<small><a href="#top">[top]</a></small> <br />
<hr />
</article>
</body>
<footer>
<p>最終更新日：2025/05/03</p>
<p>Copyright (C) 2018-2025, Yousuke Yamashita, CC BY 4.0</p>
</footer>
</html>